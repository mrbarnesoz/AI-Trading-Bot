(()=>{const{useState:O,useEffect:Z,useMemo:pe,useCallback:ue}=React;typeof dayjs<"u"&&typeof dayjs_plugin_relativeTime<"u"&&dayjs.extend(dayjs_plugin_relativeTime);const Se=8e3,he=15e3,ke=["1m","3m","5m","15m","30m","1h","2h","4h","6h","12h","1d"],Ce=[5,10,15,20,25,50,75,100],Pe=["XBTUSD","ETHUSD","SOLUSD","XRPUSD","ADAUSD","DOGEUSD"],je=["trend_follow","mean_reversion","breakout","scalper","adaptive_meta"],Re=[{name:"config.yaml",path:"config.yaml",warnings:[],updated_at:null}];function Q(...t){return t.filter(Boolean).join(" ")}function me(t,o=he,m=null){const[y,p]=O(m),[b,D]=O(null),[s,h]=O(!0),k=ue(async()=>{try{const v=await fetch(t,{credentials:"same-origin"});if(!v.ok)throw new Error(`Request failed (${v.status})`);const x=await v.json();p(x),D(null)}catch(v){console.error("Polling error for",t,v),(v&&typeof v.message=="string"?v.message:"").includes("(404)")?(p(m),D(null)):D(v)}finally{h(!1)}},[t]);return Z(()=>{let v=!0;if(!v)return;if(k(),o<=0)return()=>{v=!1};const x=setInterval(k,o);return()=>{v=!1,clearInterval(x)}},[k,o]),{data:y,error:b,loading:s,refresh:k}}async function z(t,{method:o="POST",body:m=void 0}={}){const y={method:o,headers:{"Content-Type":"application/json"},credentials:"same-origin"};m!==void 0&&(y.body=JSON.stringify(m));const p=await fetch(t,y),b=await p.text(),D=b?b.trim():"";let s={};if(D)try{s=JSON.parse(D)}catch{console.warn("Non-JSON response from",t,D),s={raw:D}}if(!p.ok){const h=s&&s.error||s&&s.message||s&&s.raw||`Request failed (${p.status})`,k=s&&Array.isArray(s.details)&&s.details.length?s.details.join("; "):"",v=k?`${h}: ${k}`:h;throw new Error(v)}return s}function $e(t){if(!t)return"";if(typeof dayjs>"u")return`Generated at ${t}`;const o=dayjs(t);return o.isValid()?`Generated ${o.fromNow()}`:`Generated at ${t}`}function Fe({alerts:t,messages:o,onDismiss:m}){const y=[];return Array.isArray(t)&&t.forEach((p,b)=>{y.push({id:`alert-${b}-${p.message}`,level:p.level||"info",text:p.message||JSON.stringify(p),sticky:!0})}),o.forEach(p=>{y.push(p)}),y.length?React.createElement("div",{className:"sticky top-0 z-30 shadow-lg"},y.map(p=>{const b=p.level==="critical"?"bg-red-900 border-red-500":p.level==="warning"?"bg-amber-900 border-amber-500":p.level==="success"?"bg-emerald-900 border-emerald-500":"bg-slate-800 border-slate-600";return React.createElement("div",{key:p.id,className:Q("flex items-center justify-between px-4 py-2 border-b text-sm",b)},React.createElement("span",{className:"font-medium"},p.text),!p.sticky&&React.createElement("button",{className:"text-xs text-slate-200 hover:text-white",onClick:()=>m(p.id)},"Dismiss"))})):null}function Oe({portfolio:t}){if(!t)return null;const o=[{label:"PnL (30d)",value:t.pnl_30d},{label:"Sharpe (30d)",value:t.sharpe},{label:"Drawdown",value:t.drawdown},{label:"Win Rate",value:t.win_rate},{label:"Trades",value:t.trades}].filter(m=>m.value!==void 0&&m.value!==null);return o.length?React.createElement("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3"},o.map(m=>React.createElement("div",{key:m.label,className:"rounded-lg bg-slate-800 px-3 py-2"},React.createElement("div",{className:"text-xs uppercase tracking-wide text-slate-400"},m.label),React.createElement("div",{className:"text-lg font-semibold"},typeof m.value=="number"?m.value.toFixed(3):m.value)))):null}function Ue({strategies:t,filters:o,onFilterChange:m,onPromote:y,onSnapshot:p}){const b=pe(()=>{if(!Array.isArray(t))return[];let s=t.slice();o.showUnderperforming&&(s=s.filter(k=>k.underperforming)),o.minTrades&&(s=s.filter(k=>(k.trades||0)>=o.minTrades));const h=o.sortKey||"sharpe";return s.sort((k,v)=>{const x=k[h]||0,L=v[h]||0;return o.sortDirection==="asc"?x-L:L-x}),s},[t,o]);if(!b.length)return React.createElement("div",{className:"rounded-lg border border-dashed border-slate-700 p-6 text-center text-slate-400"},"No strategy data available yet.");const D=b[0];return React.createElement("div",{className:"space-y-4"},React.createElement("div",{className:"flex flex-wrap items-center gap-3 justify-between"},React.createElement("div",{className:"flex flex-wrap gap-3"},React.createElement("label",{className:"flex items-center gap-2 text-sm text-slate-300"},React.createElement("input",{type:"checkbox",className:"rounded border-slate-500",checked:o.showUnderperforming,onChange:s=>m({...o,showUnderperforming:s.target.checked})}),"Underperforming only"),React.createElement("label",{className:"flex items-center gap-2 text-sm text-slate-300"},"Min trades",React.createElement("input",{type:"number",min:"0",className:"w-20 rounded bg-slate-900 px-2 py-1 text-right text-slate-200 border border-slate-700",value:o.minTrades,onChange:s=>m({...o,minTrades:Number(s.target.value)||0})})),React.createElement("label",{className:"flex items-center gap-2 text-sm text-slate-300"},"Sort",React.createElement("select",{className:"rounded bg-slate-900 px-2 py-1 border border-slate-700",value:o.sortKey,onChange:s=>m({...o,sortKey:s.target.value})},React.createElement("option",{value:"sharpe"},"Sharpe"),React.createElement("option",{value:"win_rate"},"Win Rate"),React.createElement("option",{value:"drawdown"},"Drawdown"),React.createElement("option",{value:"trades"},"Trades")),React.createElement("button",{className:"rounded bg-slate-800 px-2 py-1 text-xs border border-slate-700",onClick:()=>m({...o,sortDirection:o.sortDirection==="asc"?"desc":"asc"})},o.sortDirection==="asc"?"Asc":"Desc"))),D&&React.createElement("button",{className:"rounded bg-emerald-600 px-3 py-2 text-sm font-semibold text-white hover:bg-emerald-500",onClick:()=>y(D)},"Promote top candidate")),React.createElement("div",{className:"overflow-x-auto rounded-lg border border-slate-800"},React.createElement("table",{className:"min-w-full divide-y divide-slate-800 text-sm"},React.createElement("thead",{className:"bg-slate-900/80"},React.createElement("tr",null,React.createElement("th",{className:"px-3 py-2 text-left font-semibold text-slate-300"},"Strategy / Guidance"),React.createElement("th",{className:"px-3 py-2 text-left font-semibold text-slate-300"},"Symbol"),React.createElement("th",{className:"px-3 py-2 text-left font-semibold text-slate-300"},"Timeframe"),React.createElement("th",{className:"px-3 py-2 text-right font-semibold text-slate-300"},"Sharpe"),React.createElement("th",{className:"px-3 py-2 text-right font-semibold text-slate-300"},"Win %"),React.createElement("th",{className:"px-3 py-2 text-right font-semibold text-slate-300"},"Drawdown"),React.createElement("th",{className:"px-3 py-2 text-right font-semibold text-slate-300"},"Trades"),React.createElement("th",{className:"px-3 py-2 text-left font-semibold text-slate-300"},"Warnings"),React.createElement("th",{className:"px-3 py-2 text-right font-semibold text-slate-300"},"Actions"))),React.createElement("tbody",{className:"divide-y divide-slate-800"},b.map(s=>{const h=s.id||`${s.strategy}-${s.symbol}-${s.timeframe}`,k=s.underperforming,v=s.strategy_label||s.strategy,x=Array.isArray(s.recommended_timeframes)?s.recommended_timeframes:[],L=x.length?x.join(", "):"\u2014",E=s.default_timeframe||x[0]||"\u2014";return React.createElement("tr",{key:h,className:k?"bg-red-900/10":""},React.createElement("td",{className:"px-3 py-2 text-slate-200"},React.createElement("div",{className:"flex flex-col gap-1"},React.createElement("span",{className:"font-semibold text-slate-100"},v),React.createElement("span",{className:"text-[11px] uppercase tracking-wide text-slate-500"},"ID: ",s.strategy),React.createElement("div",{className:"text-[11px] text-slate-400"},React.createElement("span",{className:"font-medium text-slate-300"},"Default:")," ",E),React.createElement("div",{className:"text-[11px] text-slate-500"},React.createElement("span",{className:"font-medium text-slate-400"},"Recommended:")," ",L))),React.createElement("td",{className:"px-3 py-2 text-slate-300"},s.symbol||"\u2014"),React.createElement("td",{className:"px-3 py-2 text-slate-300",title:`Current: ${s.timeframe||"\u2014"} \u2022 Default: ${E} \u2022 Recommended: ${L}`},s.timeframe||"\u2014"),React.createElement("td",{className:"px-3 py-2 text-right text-slate-200"},s.sharpe!==void 0&&s.sharpe!==null?s.sharpe.toFixed(3):"\u2014"),React.createElement("td",{className:"px-3 py-2 text-right text-slate-200"},s.win_rate!==void 0&&s.win_rate!==null?(s.win_rate*100).toFixed(1)+"%":"\u2014"),React.createElement("td",{className:"px-3 py-2 text-right text-slate-200"},s.drawdown!==void 0&&s.drawdown!==null?(s.drawdown*100).toFixed(1)+"%":"\u2014"),React.createElement("td",{className:"px-3 py-2 text-right text-slate-200"},s.trades||0),React.createElement("td",{className:"px-3 py-2 text-slate-300"},Array.isArray(s.warnings)&&s.warnings.length>0?React.createElement("div",{className:"flex flex-wrap gap-1"},s.warnings.map((i,A)=>React.createElement("span",{key:A,className:"rounded bg-amber-900/40 px-2 py-0.5 text-xs text-amber-200"},i))):React.createElement("span",{className:"text-slate-500"},"\u2014")),React.createElement("td",{className:"px-3 py-2 text-right"},React.createElement("div",{className:"inline-flex items-center gap-2"},React.createElement("button",{className:"rounded bg-indigo-600 px-3 py-1 text-xs font-semibold text-white hover:bg-indigo-500",onClick:()=>y(s),disabled:!s.config,title:s.config||"No config path available"},"Promote"),React.createElement("button",{className:"rounded bg-slate-800 px-3 py-1 text-xs text-slate-200 hover:bg-slate-700",onClick:()=>p(s),disabled:!s.config},"Snapshot"))))})))))}function Be({preview:t,onClose:o}){if(!t)return null;const{job:m,results:y}=t,p=[];m?.strategy&&p.push(m.strategy),m?.timeframe&&p.push(m.timeframe),Array.isArray(m?.pairs)&&m.pairs.length?p.push(m.pairs.join(", ")):m?.pair&&p.push(m.pair);const b=p.length?p.join(" \u2022 "):m?.id,D=s=>{!s||typeof navigator>"u"||!navigator.clipboard||navigator.clipboard.writeText(s).catch(()=>{})};return React.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-950/80 px-4 py-8 backdrop-blur-sm"},React.createElement("div",{className:"max-h-[80vh] w-full max-w-4xl overflow-hidden rounded-lg border border-slate-800 bg-slate-950 shadow-2xl"},React.createElement("div",{className:"flex items-start justify-between gap-3 border-b border-slate-800 px-5 py-4"},React.createElement("div",{className:"space-y-1"},React.createElement("h3",{className:"text-lg font-semibold text-white"},"Backtest results"),b&&React.createElement("p",{className:"text-xs text-slate-400"},b)),React.createElement("button",{className:"rounded bg-slate-800 px-3 py-1.5 text-xs font-semibold text-slate-200 hover:bg-slate-700",onClick:o},"Close")),React.createElement("div",{className:"max-h-[65vh] overflow-y-auto px-5 py-4 space-y-4"},(!y||y.length===0)&&React.createElement("div",{className:"rounded border border-slate-800 bg-slate-900/60 px-4 py-6 text-center text-sm text-slate-400"},"No result artifacts matched this job yet."),y&&y.map(s=>{const h=s.metadata||{},k=s.summary||{},v=s.file||s.path||Math.random().toString(36).slice(2),L=[{label:"Sharpe",value:s.sharpe},{label:"Trades",value:s.trades},{label:"Return",value:s.return},{label:"Capital %",value:s.capital_pct},{label:"Symbol",value:h.symbol||h.pair},{label:"Timeframe",value:h.interval||h.timeframe},{label:"Strategy",value:h.strategy||h.mode}].filter(E=>E.value!==void 0&&E.value!==null&&E.value!=="");return React.createElement("div",{key:v,className:"space-y-2 rounded border border-slate-800 bg-slate-900/70 p-4"},React.createElement("div",{className:"flex flex-wrap items-start justify-between gap-3"},React.createElement("div",null,React.createElement("div",{className:"text-sm font-semibold text-slate-100"},s.file||"Result"),React.createElement("div",{className:"text-xs text-slate-500"},$e(s.generated_at))),React.createElement("div",{className:"flex flex-wrap items-center gap-2 text-xs text-slate-300"},s.path&&React.createElement("button",{className:"rounded border border-slate-700 px-2 py-1 hover:bg-slate-800",onClick:()=>D(s.path)},"Copy path"),s.path&&React.createElement("a",{className:"rounded border border-slate-700 px-2 py-1 hover:bg-slate-800",href:`/api/backtests/results/${encodeURIComponent(s.file)}`,target:"_blank",rel:"noreferrer"},"Open JSON"))),L.length>0&&React.createElement("div",{className:"grid gap-2 text-xs text-slate-300 md:grid-cols-3"},L.map(E=>React.createElement("div",{key:E.label,className:"rounded bg-slate-950/60 px-3 py-2"},React.createElement("div",{className:"text-[10px] uppercase tracking-wide text-slate-500"},E.label),React.createElement("div",{className:"text-sm font-semibold text-slate-100"},typeof E.value=="number"?E.value.toFixed(4):E.value)))),k&&Object.keys(k).length>0&&React.createElement("details",{className:"rounded border border-slate-800 bg-slate-950/50"},React.createElement("summary",{className:"cursor-pointer px-3 py-2 text-xs font-semibold text-slate-200"},"Summary details"),React.createElement("pre",{className:"overflow-x-auto px-3 py-2 text-[11px] leading-relaxed text-slate-200"},JSON.stringify(k,null,2))))}))))}function Ie({data:t,onLaunch:o,launching:m,strategyOptions:y=[],strategyMetadata:p={},symbolOptions:b=[],timeframeOptions:D=[],capitalOptions:s=[],onNotify:h=()=>{},onRefresh:k=()=>{},onClearJobs:v=()=>{},clearingJobs:x=!1,onClearGuardrails:L=()=>{},clearingGuardrails:E=!1}){const[i,A]=O({strategies:[],symbols:[],timeframes:{},capital_pct:s[0]??Ce[0]??10,start_date:"",end_date:""}),[U,I]=O(null),[J,a]=O(null),[c,R]=O(!1),[$,Y]=O(null);Z(()=>{!i.strategies.length&&y.length&&A(e=>({...e,strategies:[y[0]]}))},[y]),Z(()=>{!i.symbols.length&&b.length&&A(e=>({...e,symbols:[b[0]]}))},[b]),Z(()=>{s.length&&!s.includes(Number(i.capital_pct))&&A(e=>({...e,capital_pct:s[0]}))},[s]);const V=ue(e=>{if(!e)return"";const l=p[e];return l&&l.label||e},[p]),G=ue(e=>{if(!e)return[];const l=p[e]||{},f=Array.isArray(l.recommended_timeframes)&&l.recommended_timeframes.length?l.recommended_timeframes:D,N=Array.isArray(f)?f:[],w=new Set,P=[];return N.forEach(C=>{const T=String(C);w.has(T)||(w.add(T),P.push(T))}),P},[p,D]);Z(()=>{const e=i.strategies;A(l=>{const f={...l.timeframes||{}},N=new Set(e);Object.keys(f).forEach(T=>{N.has(T)||delete f[T]}),e.forEach(T=>{const B=G(T);if(!B.length){delete f[T];return}const re=p[T]||{},ie=re&&re.default_timeframe&&B.includes(re.default_timeframe)?re.default_timeframe:B[0],M=l.timeframes?l.timeframes[T]:void 0;M&&B.includes(M)?f[T]=M:f[T]=ie});const w=l.timeframes||{};return Object.keys(f).length===Object.keys(w).length&&Object.entries(f).every(([T,B])=>w[T]===B)?l:{...l,timeframes:f}})},[i.strategies,p,D,G]);const ee=Array.isArray(t.guardrail_logs)?t.guardrail_logs:[],H=Array.isArray(t.guardrail_snapshots)?t.guardrail_snapshots:[],oe=Array.isArray(t.jobs)?t.jobs:[],te=Array.isArray(t.results)?t.results:[],se=ue(e=>{if(!e)return[];const l=(e.config||"").toLowerCase(),f=(e.strategy||"").toLowerCase(),N=(e.timeframe||"").toLowerCase(),w=Array.isArray(e.plan_summary)?e.plan_summary:[],P=new Set(w.map(j=>String(j.strategy||"").toLowerCase()).filter(j=>j)),C=new Set(w.map(j=>String(j.timeframe||"").toLowerCase()).filter(j=>j)),T=new Set(w.flatMap(j=>j.symbols||[]).map(j=>String(j).toUpperCase()).filter(j=>j));(Array.isArray(e.pairs)?e.pairs.map(j=>String(j).toUpperCase()):e.pair?[String(e.pair).toUpperCase()]:[]).forEach(j=>T.add(j));const re=j=>{const X=(j||"").toLowerCase();return X?P.size?P.has(X):f&&(X===f||X.includes(f)):!1},ie=j=>{const X=(j||"").toLowerCase();return C.size?X?C.has(X):!1:N?!j||X===N:!0};return te.filter(j=>{if(!j||typeof j!="object")return!1;const X=(j.config||"").toLowerCase();if(l&&X&&X===l)return!0;const xe=(j.file||"").toLowerCase();if(f&&xe.includes(f))return!0;const ce=j.metadata||{},Ne=(ce.strategy||ce.mode||"").toLowerCase(),ge=(ce.interval||ce.timeframe||"").toLowerCase(),we=(ce.symbol||ce.pair||"").toUpperCase();return!!(Ne&&re(Ne)&&ie(ge)||T.size&&we&&T.has(we)&&ie(ge)||T.size&&xe&&Array.from(T).some(_e=>xe.includes(_e.toLowerCase())))})},[te]),fe=e=>l=>{const f=l.target.value;A(N=>({...N,timeframes:{...N.timeframes||{},[e]:f}}))},de=e=>l=>{const f=Array.from(l.target.selectedOptions).map(N=>N.value);A(N=>({...N,[e]:f}))},ne=e=>l=>{const f=e==="capital_pct"?Number(l.target.value):l.target.value;A(N=>({...N,[e]:f}))},S=i.strategies.length>0&&i.strategies.every(e=>{const l=i.timeframes?i.timeframes[e]:"";return l?G(e).includes(l):!1})&&Number(i.capital_pct)>0,le=e=>{if(!e)return;const l=se(e);if(!l.length){const f=Array.isArray(e.plan_summary)?e.plan_summary.map(w=>w.label||w.strategy).filter(Boolean):[],N=f.length>0?f.join(", "):e.strategy||e.id||"selection";h(`No matching backtest results found for ${N}.`,"warning");return}I({job:e,results:l})},ae=async e=>{if(!e||!e.file){h("Result file reference missing.","warning");return}try{Y(e.file);const l=await z(`/api/backtests/results/${encodeURIComponent(e.file)}`,{method:"GET"}),f=l&&l.metadata?l.metadata:{},N=e.identity||{},w={strategy:N.strategy||f.strategy||e.strategy,timeframe:f.interval||f.timeframe||e.timeframe,pairs:N.symbol?[N.symbol]:void 0,pair:N.symbol||f.symbol||f.pair,id:e.file};I({job:w,results:[{...l,file:e.file,path:e.path||l.path,generated_at:e.generated_at||l.generated_at}]})}catch(l){h(`Failed to open result: ${l.message}`,"critical")}finally{Y(null)}},d=async()=>{if(!c)try{if(typeof window<"u"&&!window.confirm("Clear all recent results from the panel?"))return;R(!0),await z("/api/backtests/results",{method:"DELETE"}),h("Cleared latest results.","success"),typeof k=="function"&&k()}catch(e){h(`Failed to clear results: ${e.message}`,"critical")}finally{R(!1)}},_=async(e,l)=>{if(e&&(e.stopPropagation(),e.preventDefault()),!l||!l.id)return;const f=String(l.status||"").toLowerCase();if(!["completed","failed","stopped","cancelled"].includes(f)){h("Only completed or failed jobs can be archived.","warning");return}let w=!1;f==="completed"&&(w=typeof window<"u"&&window.confirm("Archive matching backtest result files as well?"));try{a(l.id);const P=await z(`/api/jobs/${encodeURIComponent(l.id)}/archive`,{method:"POST",body:{archive_results:w}}),C=Array.isArray(P.archived_results)?P.archived_results.length:0,T=C>0?`Archived job ${l.id} and moved ${C} result ${C===1?"file":"files"}.`:`Archived job ${l.id}.`;h(T,"success"),typeof k=="function"&&k()}catch(P){h(`Archive failed: ${P.message}`,"critical")}finally{a(null)}},F=async e=>{if(e.preventDefault(),!S)return;const l={};i.strategies.forEach(N=>{const w=i.timeframes?i.timeframes[N]:"";w&&(l[N]=w)});const f={strategies:i.strategies,symbols:i.symbols,capital_pct:Number(i.capital_pct)||0};if(Object.keys(l).length){f.timeframes=l;const N=i.strategies[0];N&&l[N]&&(f.timeframe=l[N])}i.start_date&&(f.start_date=i.start_date),i.end_date&&(f.end_date=i.end_date),await o(f),A(N=>({...N,start_date:"",end_date:""}))};return Z(()=>{if(!U)return;const e=se(U.job),l=Array.isArray(U.results)?U.results.map(w=>w?.path||w?.file||"").join("|"):"",f=e.map(w=>w?.path||w?.file||"").join("|");(Array.isArray(U.results)?U.results.length:0)===e.length&&l===f||I(w=>({...w,results:e}))},[te,U,se]),React.createElement("div",{className:"space-y-6"},React.createElement("form",{onSubmit:F,className:"grid gap-4 rounded-lg border border-slate-800 bg-slate-900/40 p-4 md:grid-cols-3"},React.createElement("div",{className:"md:col-span-1 space-y-2"},React.createElement("label",{className:"text-xs uppercase tracking-wide text-slate-400"},"Strategies"),React.createElement("select",{multiple:!0,className:"h-32 w-full rounded border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-200",value:i.strategies,onChange:de("strategies")},y.map(e=>React.createElement("option",{key:e,value:e},V(e)))),React.createElement("p",{className:"text-xs text-slate-500"},"Select one or more strategies (Ctrl/Cmd + click for multi-select).")),React.createElement("div",{className:"md:col-span-1 space-y-2"},React.createElement("label",{className:"text-xs uppercase tracking-wide text-slate-400"},"Symbols"),React.createElement("select",{multiple:!0,className:"h-32 w-full rounded border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-200",value:i.symbols,onChange:de("symbols")},b.map(e=>React.createElement("option",{key:e,value:e},e))),React.createElement("p",{className:"text-xs text-slate-500"},"Select the BitMEX symbols to include. Leave empty to use the strategy defaults.")),React.createElement("div",{className:"md:col-span-1 grid grid-cols-2 gap-3"},React.createElement("div",{className:"col-span-2 space-y-2"},React.createElement("label",{className:"text-xs uppercase tracking-wide text-slate-400"},"Timeframes"),i.strategies.length===0?React.createElement("p",{className:"text-xs text-slate-500"},"Select at least one strategy to view recommended timeframes."):React.createElement("div",{className:"space-y-2"},i.strategies.map(e=>{const l=G(e),f=i.timeframes&&i.timeframes[e]||"",N=V(e);return React.createElement("div",{key:e,className:"space-y-1"},React.createElement("div",{className:"text-[11px] uppercase tracking-wide text-slate-500"},N),l.length?React.createElement("select",{className:"w-full rounded border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-200",value:f,onChange:fe(e)},l.map(w=>React.createElement("option",{key:w,value:w},w))):React.createElement("div",{className:"rounded border border-amber-800/60 bg-amber-900/20 px-3 py-2 text-xs text-amber-200"},"No recommended timeframes available."))}))),React.createElement("div",{className:"space-y-2"},React.createElement("label",{className:"text-xs uppercase tracking-wide text-slate-400"},"Capital %"),React.createElement("select",{className:"w-full rounded border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-200",value:i.capital_pct,onChange:ne("capital_pct")},s.map(e=>React.createElement("option",{key:e,value:e},e,"%")))),React.createElement("div",{className:"space-y-2"},React.createElement("label",{className:"text-xs uppercase tracking-wide text-slate-400"},"Start date"),React.createElement("input",{type:"date",className:"w-full rounded border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-200",value:i.start_date,onChange:ne("start_date")})),React.createElement("div",{className:"space-y-2"},React.createElement("label",{className:"text-xs uppercase tracking-wide text-slate-400"},"End date"),React.createElement("input",{type:"date",className:"w-full rounded border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-200",value:i.end_date,onChange:ne("end_date")}))),React.createElement("div",{className:"md:col-span-3 flex justify-end"},React.createElement("button",{type:"submit",className:"inline-flex items-center gap-2 rounded bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-500 disabled:opacity-60",disabled:m||!S},m?"Queueing...":"Launch backtest"))),React.createElement("div",{className:"grid gap-5 md:grid-cols-2"},React.createElement("div",{className:"space-y-2 rounded-lg border border-slate-800 bg-slate-900/50 p-4"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",null,React.createElement("h3",{className:"text-sm font-semibold text-slate-200 uppercase tracking-wide"},"Job queue"),React.createElement("p",{className:"text-xs text-slate-500"},"Double-click a job to open its recent backtest results.")),React.createElement("button",{type:"button",className:"rounded bg-slate-800 px-3 py-1.5 text-xs font-semibold text-slate-200 hover:bg-slate-700 disabled:cursor-not-allowed disabled:opacity-60",onClick:v,disabled:x},x?"Clearing\u2026":"Clear jobs")),React.createElement("div",{className:"space-y-3 max-h-72 overflow-y-auto pr-1"},oe.length===0&&React.createElement("p",{className:"text-sm text-slate-500"},"No queued jobs."),oe.map(e=>{const l=Array.isArray(e.plan_summary)?e.plan_summary:[],f=l.map(C=>C.label||C.strategy).filter(Boolean),N=l.map(C=>C.timeframe).filter((C,T,B)=>C&&B.indexOf(C)===T),w=l.flatMap(C=>C.symbols||[]).filter((C,T,B)=>B.indexOf(C)===T),P=l.length||(Array.isArray(e.plan)?e.plan.length:0);return React.createElement("div",{key:e.id,className:"rounded border border-slate-800 p-3",onDoubleClick:()=>le(e)},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",null,React.createElement("span",{className:"font-semibold text-slate-100"},e.type||"job"," \u2022 ",e.status||"unknown"),P>0&&React.createElement("span",{className:"ml-2 rounded bg-slate-800/70 px-2 py-0.5 text-[11px] font-semibold text-slate-300"},P," strategy",P===1?"":" combos")),React.createElement("span",{className:"text-xs text-slate-400",title:e.submitted_at||""},e.submitted_at?dayjs(e.submitted_at).fromNow():"")),React.createElement("div",{className:"mt-1 grid grid-cols-2 gap-1 text-xs text-slate-400"},f.length?React.createElement("div",{className:"col-span-2"},"Strategies: ",React.createElement("span",{className:"text-slate-200"},f.join(", "))):e.strategy&&React.createElement("div",null,"Strategy: ",e.strategy),N.length?React.createElement("div",{className:"col-span-2"},"Timeframes: ",React.createElement("span",{className:"text-slate-200"},N.join(", "))):e.timeframe&&React.createElement("div",null,"TF: ",e.timeframe),w.length?React.createElement("div",{className:"col-span-2"},"Symbols: ",React.createElement("span",{className:"text-slate-200"},w.join(", "))):e.pair&&React.createElement("div",null,"Pair: ",e.pair),e.capital_pct!==void 0&&React.createElement("div",null,"Capital %: ",e.capital_pct)),l.length>0&&React.createElement("div",{className:"mt-3 space-y-3 rounded border border-slate-800/70 bg-slate-950/30 px-3 py-2 text-xs text-slate-200"},l.map((C,T)=>React.createElement("div",{key:`${e.id}-${C.strategy}-${C.timeframe}-${T}`,className:"space-y-1"},React.createElement("div",{className:"font-semibold text-slate-100"},C.label||C.strategy," \u2022 ",C.timeframe||"\u2014"),React.createElement("div",{className:"text-slate-400"},C.entry_reason),React.createElement("div",{className:"text-slate-400"},"Exit plan: ",C.exit_reason)))),React.createElement("div",{className:"mt-2 flex flex-wrap gap-2 text-xs"},React.createElement("button",{className:"rounded bg-slate-800 px-3 py-1 font-semibold text-slate-200 hover:bg-slate-700 disabled:cursor-not-allowed disabled:opacity-50",onClick:C=>_(C,e),disabled:J===e.id||!["completed","failed","stopped","cancelled"].includes(String(e.status||"").toLowerCase())},J===e.id?"Archiving...":"Archive")),e.error&&React.createElement("div",{className:"mt-2 rounded bg-red-900/40 px-3 py-2 text-xs text-red-200"},e.error))}))),React.createElement("div",{className:"space-y-2 rounded-lg border border-slate-800 bg-slate-900/50 p-4"},React.createElement("div",{className:"flex items-center justify-between gap-3"},React.createElement("h3",{className:"text-sm font-semibold text-slate-200 uppercase tracking-wide"},"Latest results"),React.createElement("button",{type:"button",className:"rounded bg-slate-800 px-3 py-1.5 text-xs font-semibold text-slate-200 hover:bg-slate-700 disabled:cursor-not-allowed disabled:opacity-60",onClick:d,disabled:c||te.length===0},c?"Clearing\u2026":"Clear")),React.createElement("div",{className:"space-y-3 max-h-72 overflow-y-auto pr-1"},te.length===0&&React.createElement("p",{className:"text-sm text-slate-500"},"No results yet."),te.map(e=>{const l=e.identity||{},f=e.summary||{},N=e.explanations||{},w=e.strategy_label||l.label||e.strategy||l.strategy||e.config||"Result",P=[],C=l.symbol||e.metadata&&(e.metadata.symbol||e.metadata.pair),T=l.timeframe||e.metadata&&(e.metadata.interval||e.metadata.timeframe);C&&P.push(C),T&&P.push(T),e.capital_pct&&P.push(`${e.capital_pct}% capital`);const B=[{label:"Sharpe",value:f.calc_sharpe??e.sharpe},{label:"Trades",value:f.trades_count??e.trades},{label:"Return",value:f.total_return??e.return},{label:"Max DD",value:f.max_drawdown}].filter(M=>M.value!==void 0&&M.value!==null&&M.value!==""&&!Number.isNaN(M.value)),re=N.entry,ie=N.exit;return React.createElement("div",{key:e.path||e.file||e.config,className:"rounded border border-slate-800 p-3"},React.createElement("div",{className:"flex items-start justify-between gap-3"},React.createElement("div",null,React.createElement("div",{className:"font-semibold text-slate-100"},w),P.length>0&&React.createElement("div",{className:"text-xs text-slate-400"},P.join(" \u2022 ")),$e(e.generated_at)&&React.createElement("div",{className:"text-[11px] text-slate-500"},$e(e.generated_at))),React.createElement("div",{className:"flex flex-wrap gap-2 text-xs text-slate-200"},React.createElement("button",{className:"rounded bg-slate-800 px-3 py-1 font-semibold hover:bg-slate-700 disabled:cursor-not-allowed disabled:opacity-60",onClick:()=>ae(e),disabled:$===e.file||!e.file},$===e.file?"Opening\u2026":"View details"),e.file&&React.createElement("a",{className:"rounded border border-slate-700 px-3 py-1 hover:bg-slate-800",href:`/api/backtests/results/${encodeURIComponent(e.file)}`,target:"_blank",rel:"noreferrer"},"Open JSON"))),re&&React.createElement("p",{className:"mt-2 text-xs text-slate-300"},"Purpose: ",React.createElement("span",{className:"text-slate-100"},re)),ie&&React.createElement("p",{className:"text-xs text-slate-400"},"Exit plan: ",ie),B.length>0&&React.createElement("div",{className:"mt-2 grid gap-2 text-xs text-slate-300 sm:grid-cols-2"},B.map(M=>React.createElement("div",{key:M.label,className:"rounded bg-slate-950/50 px-2 py-1.5"},React.createElement("div",{className:"text-[10px] uppercase tracking-wide text-slate-500"},M.label),React.createElement("div",{className:"text-sm font-semibold text-slate-100"},typeof M.value=="number"?M.value.toFixed(4):M.value)))),Array.isArray(e.flags)&&e.flags.length>0&&React.createElement("div",{className:"mt-2 flex flex-wrap gap-1"},e.flags.map(M=>React.createElement("span",{key:M,className:"rounded bg-amber-900/30 px-2 py-0.5 text-xs text-amber-200"},M))))})))),React.createElement("div",{className:"grid gap-5 md:grid-cols-2"},React.createElement("div",{className:"rounded-lg border border-red-900/40 bg-red-950/40 p-4"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("h3",{className:"text-sm font-semibold uppercase tracking-wide text-red-200"},"Guardrail violations (latest)"),React.createElement("button",{type:"button",className:"rounded bg-red-900/60 px-3 py-1.5 text-xs font-semibold text-red-100 hover:bg-red-800 disabled:cursor-not-allowed disabled:opacity-60",onClick:L,disabled:E},E?"Clearing\u2026":"Clear logs")),React.createElement("div",{className:"mt-3 space-y-3 max-h-64 overflow-y-auto pr-1"},ee.length===0&&React.createElement("p",{className:"text-sm text-red-200/70"},"No guardrail breaches recorded."),ee.map((e,l)=>React.createElement("div",{key:l,className:"rounded border border-red-800/50 bg-red-900/30 p-3 text-sm"},React.createElement("div",{className:"flex items-center justify-between text-xs text-red-100/80"},React.createElement("span",null,e.rule||e.guardrail||"rule"),React.createElement("span",null,e.timestamp?dayjs(e.timestamp).format("YYYY-MM-DD HH:mm"):"")),e.message&&React.createElement("div",{className:"mt-1 text-red-100"},e.message),e.details&&React.createElement("pre",{className:"mt-2 overflow-x-auto rounded bg-red-900/40 p-2 text-[11px] text-red-100"},JSON.stringify(e.details,null,2)))))),React.createElement("div",{className:"rounded-lg border border-slate-800 bg-slate-900/60 p-4"},React.createElement("h3",{className:"text-sm font-semibold uppercase tracking-wide text-slate-200"},"Guardrail snapshots"),React.createElement("div",{className:"mt-3 space-y-3 max-h-64 overflow-y-auto pr-1 text-sm"},H.length===0&&React.createElement("p",{className:"text-slate-400"},"No snapshots captured yet."),H.map(e=>React.createElement("div",{key:e.path,className:"rounded border border-slate-800/80 p-3"},React.createElement("div",{className:"flex items-center justify-between text-xs text-slate-400"},React.createElement("span",null,e.name),React.createElement("span",null,e.created_at?dayjs(e.created_at).fromNow():"")),React.createElement("pre",{className:"mt-2 overflow-x-auto rounded bg-slate-950/60 p-2 text-[11px] text-slate-200"},JSON.stringify(e.summary,null,2))))))),U&&React.createElement(Be,{preview:U,onClose:()=>I(null)}))}function Me({status:t={},strategyOptions:o=[],strategyMetadata:m={},symbolOptions:y=[],timeframeOptions:p=[],capitalOptions:b=[],onStartPaper:D,onStartLive:s,onStop:h,onNotify:k=()=>{},working:v={}}){const[x,L]=O({strategies:[],symbols:[],timeframes:{},capital_pct:b[0]??Ce[0]??10});Z(()=>{!x.strategies.length&&o.length&&L(d=>({...d,strategies:[o[0]]}))},[o]),Z(()=>{!x.symbols.length&&y.length&&L(d=>({...d,symbols:[y[0]]}))},[y]),Z(()=>{b.length&&!b.includes(Number(x.capital_pct))&&L(d=>({...d,capital_pct:b[0]}))},[b]);const E=ue(d=>{if(!d)return"";const _=m[d];return _&&_.label||d},[m]),i=ue(d=>{if(!d)return[];const _=m[d]||{},F=Array.isArray(_.recommended_timeframes)&&_.recommended_timeframes.length?_.recommended_timeframes:p,e=[],l=new Set;return(Array.isArray(F)?F:[]).forEach(f=>{const N=String(f);l.has(N)||(l.add(N),e.push(N))}),e.length?e:ke},[m,p]);Z(()=>{const d=x.strategies;L(_=>{const F={..._.timeframes||{}},e=new Set(d);Object.keys(F).forEach(w=>{e.has(w)||delete F[w]}),d.forEach(w=>{const P=i(w);if(!P.length){delete F[w];return}const C=m[w]||{},T=C&&C.default_timeframe&&P.includes(C.default_timeframe)?C.default_timeframe:P[0],B=_.timeframes?_.timeframes[w]:void 0;B&&P.includes(B)?F[w]=B:F[w]=T});const l=_.timeframes||{};return Object.keys(F).length===Object.keys(l).length&&Object.entries(F).every(([w,P])=>l[w]===P)?_:{..._,timeframes:F}})},[x.strategies,m,i]);const A=d=>_=>{const F=Array.from(_.target.selectedOptions).map(e=>e.value);L(e=>({...e,[d]:F}))},U=d=>_=>{const F=d==="capital_pct"?Number(_.target.value):_.target.value;L(e=>({...e,[d]:F}))},I=t.paper||{},J=t.live||{},a=t.guardrails||{},c=t.open_positions||{},R=typeof c.notional_usd=="number"&&Number.isFinite(c.notional_usd)?c.notional_usd:null,$=typeof c.pnl_usd=="number"&&Number.isFinite(c.pnl_usd)?c.pnl_usd:null,Y=R&&R!==0&&$!==null?$/Math.abs(R)*100:null,V=d=>{if(!d)return"Never";if(typeof dayjs>"u")return d;const _=dayjs(d);return _.isValid()?_.fromNow():d},G=(d,_=2)=>typeof d=="number"&&Number.isFinite(d)?d.toLocaleString(void 0,{style:"currency",currency:"USD",minimumFractionDigits:_,maximumFractionDigits:_}):"\u2014",ee=(d,_=2)=>typeof d=="number"&&Number.isFinite(d)?`${d.toFixed(_)}%`:"\u2014",H=d=>typeof d=="number"&&Number.isFinite(d)?d>0?"text-emerald-400":d<0?"text-rose-400":"text-slate-200":"text-slate-200",te=x.strategies.length>0&&x.strategies.every(d=>{const _=x.timeframes?x.timeframes[d]:"";return _?i(d).includes(_):!1})&&Number(x.capital_pct)>0,se=x.symbols&&x.symbols.length>0,fe={strategies:x.strategies,symbols:x.symbols.map(d=>String(d||"").toUpperCase()),timeframes:x.timeframes,capital_pct:Number(x.capital_pct)||0},de=te&&se&&!I.running&&!I.pending&&!v.paper,ne=te&&se&&a.paper_is_recent&&!J.running&&!J.pending&&!v.live,be=()=>{if(!de||typeof D!="function"){se||k("Select at least one symbol to start paper trading.","warning");return}D(fe)},S=()=>{if(!ne||typeof s!="function"){a.paper_is_recent?se||k("Select at least one symbol before starting live trading.","warning"):k("Run a recent paper session before going live.","warning");return}s(fe)},le=v.stop||null,ae=d=>()=>{typeof h=="function"&&h(d)};return React.createElement("div",{className:"space-y-4 rounded-lg border border-slate-800 bg-slate-900/40 p-4"},React.createElement("div",{className:"grid gap-6 md:grid-cols-[2fr,1fr]"},React.createElement("div",{className:"space-y-4"},React.createElement("div",{className:"grid gap-3 md:grid-cols-2"},React.createElement("div",{className:"space-y-2"},React.createElement("label",{className:"text-xs uppercase tracking-wide text-slate-400"},"Strategies"),React.createElement("select",{multiple:!0,className:"h-32 w-full rounded border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-200",value:x.strategies,onChange:A("strategies")},o.map(d=>React.createElement("option",{key:d,value:d},E(d)))),React.createElement("p",{className:"text-xs text-slate-500"},"Select one or more strategies to launch (Ctrl/Cmd + click).")),React.createElement("div",{className:"space-y-2"},React.createElement("label",{className:"text-xs uppercase tracking-wide text-slate-400"},"Symbols"),React.createElement("select",{multiple:!0,className:"h-32 w-full rounded border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-200",value:x.symbols,onChange:A("symbols")},y.map(d=>React.createElement("option",{key:d,value:d},d))),React.createElement("p",{className:"text-xs text-slate-500"},"Choose the trading pairs to launch sessions against.")),React.createElement("div",{className:"md:col-span-2 space-y-2"},React.createElement("label",{className:"text-xs uppercase tracking-wide text-slate-400"},"Timeframes"),x.strategies.length===0?React.createElement("p",{className:"text-xs text-slate-500"},"Select at least one strategy to configure timeframes."):React.createElement("div",{className:"grid gap-2 md:grid-cols-2"},x.strategies.map(d=>{const _=i(d),F=x.timeframes&&x.timeframes[d]||"",e=E(d);return React.createElement("div",{key:d,className:"space-y-1"},React.createElement("div",{className:"text-[11px] uppercase tracking-wide text-slate-500"},e),_.length?React.createElement("select",{className:"w-full rounded border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-200",value:F,onChange:l=>{const f=l.target.value;L(N=>({...N,timeframes:{...N.timeframes||{},[d]:f}}))}},_.map(l=>React.createElement("option",{key:l,value:l},l))):React.createElement("div",{className:"rounded border border-amber-800/60 bg-amber-900/20 px-3 py-2 text-xs text-amber-200"},"No recommended timeframes available."))}))),React.createElement("div",{className:"space-y-2"},React.createElement("label",{className:"text-xs uppercase tracking-wide text-slate-400"},"Capital %"),React.createElement("select",{className:"w-full rounded border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-200",value:x.capital_pct,onChange:U("capital_pct")},(b.length?b:Ce).map(d=>React.createElement("option",{key:d,value:d},d,"%"))))),React.createElement("div",{className:"flex flex-wrap gap-3"},React.createElement("button",{className:"rounded bg-slate-200 px-4 py-2 text-sm font-semibold text-slate-900 hover:bg-white disabled:cursor-not-allowed disabled:opacity-60",onClick:be,disabled:!de},v.paper?"Starting paper...":"Start paper trading"),React.createElement("button",{className:"rounded bg-emerald-600 px-4 py-2 text-sm font-semibold text-white hover:bg-emerald-500 disabled:cursor-not-allowed disabled:opacity-60",onClick:S,disabled:!ne},v.live?"Starting live...":"Start live trading"),React.createElement("button",{className:"rounded bg-slate-800 px-4 py-2 text-sm font-semibold text-slate-200 hover:bg-slate-700 disabled:cursor-not-allowed disabled:opacity-60",onClick:ae("paper"),disabled:!I.running&&!I.pending||le==="paper"},le==="paper"?"Stopping paper...":"Stop paper"),React.createElement("button",{className:"rounded bg-slate-800 px-4 py-2 text-sm font-semibold text-slate-200 hover:bg-slate-700 disabled:cursor-not-allowed disabled:opacity-60",onClick:ae("live"),disabled:!J.running&&!J.pending||le==="live"},le==="live"?"Stopping live...":"Stop live"),React.createElement("button",{className:"rounded bg-red-700 px-4 py-2 text-sm font-semibold text-white hover:bg-red-600 disabled:cursor-not-allowed disabled:opacity-60",onClick:ae(void 0),disabled:le==="all"},le==="all"?"Stopping...":"Stop all")),!a.paper_is_recent&&React.createElement("div",{className:"rounded border border-amber-800 bg-amber-900/30 px-3 py-2 text-xs text-amber-100"},"Run a paper session (or rerun) before attempting live trading. Last paper: ",V(a.last_paper))),React.createElement("div",{className:"space-y-3 text-sm"},React.createElement("div",{className:"rounded border border-slate-800 bg-slate-950 px-3 py-3"},React.createElement("div",{className:"flex items-center justify-between text-xs uppercase tracking-wide text-slate-400"},React.createElement("span",null,"Paper status"),React.createElement("span",null,I.running?"running":I.pending?"starting":"idle")),React.createElement("div",{className:"mt-1 text-xs text-slate-300"},"Started: ",V(I.started_at)),React.createElement("div",{className:"text-xs text-slate-300"},"Last stop: ",V(I.ended_at))),React.createElement("div",{className:"rounded border border-slate-800 bg-slate-950 px-3 py-3"},React.createElement("div",{className:"flex items-center justify-between text-xs uppercase tracking-wide text-slate-400"},React.createElement("span",null,"Live status"),React.createElement("span",null,J.running?"running":J.pending?"starting":"idle")),React.createElement("div",{className:"mt-1 text-xs text-slate-300"},"Started: ",V(J.started_at)),React.createElement("div",{className:"text-xs text-slate-300"},"Last stop: ",V(J.ended_at))),React.createElement("div",{className:"rounded border border-slate-800 bg-slate-950 px-3 py-3"},React.createElement("div",{className:"text-xs uppercase tracking-wide text-slate-400"},"Open positions"),React.createElement("div",{className:"mt-2 space-y-1 text-xs text-slate-300"},React.createElement("div",null,"Count: ",c.count??0),React.createElement("div",null,"Exposure: ",G(c.notional_usd,0)),React.createElement("div",null,"PnL:"," ",React.createElement("span",{className:H(c.pnl_usd)},G(c.pnl_usd,2))),React.createElement("div",null,"Realised %:"," ",React.createElement("span",{className:H(Y)},ee(Y,2)))),c.symbols&&Object.keys(c.symbols).length>0&&React.createElement("div",{className:"mt-3 border-t border-slate-800 pt-2 text-xs text-slate-300"},React.createElement("div",{className:"mb-1 text-[11px] uppercase tracking-wide text-slate-500"},"By symbol"),React.createElement("div",{className:"space-y-1"},Object.entries(c.symbols).slice(0,6).map(([d,_])=>{const F=_&&typeof _.pnl_usd=="number"?_.pnl_usd:null,e=_&&typeof _.notional_usd=="number"?_.notional_usd:null,l=e&&e!==0&&F!==null?F/Math.abs(e)*100:null;return React.createElement("div",{key:d,className:"flex items-center justify-between rounded bg-slate-900/70 px-2 py-1"},React.createElement("div",{className:"font-mono text-[11px] text-slate-200"},d," \xB7 ",_&&_.count?_.count:0," pos"),React.createElement("div",{className:"flex items-center gap-2 text-[11px]"},React.createElement("span",{className:"text-slate-400"},G(e,0)),React.createElement("span",{className:H(F)},G(F,2)," (",ee(l,2),")")))}),Object.keys(c.symbols).length>6&&React.createElement("div",{className:"text-[11px] text-slate-500"},"Showing first 6 symbols. View the trade log for full detail.")))))))}function Ke({data:t,onSave:o,onRevert:m,loading:y}){let p=Array.isArray(t.configs)?t.configs.slice():[];p.length||(p=Re);const[b,D]=O(null),[s,h]=O(""),[k,v]=O(!1);Z(()=>{b||(h(""),v(!1))},[b]);const x=async i=>{const A=await z(`/api/configs/${encodeURIComponent(i.name)}`,{method:"GET"});D(i),h(A.content||""),v(!1)},L=async()=>{b&&(await o(b,s),v(!1))},E=async()=>{b&&(await m(b),D(null),h(""))};return React.createElement("div",{className:"grid gap-4 md:grid-cols-[260px,1fr]"},React.createElement("div",{className:"rounded-lg border border-slate-800 bg-slate-900/60 p-3"},React.createElement("div",{className:"mb-3 text-xs font-semibold uppercase tracking-wide text-slate-400"},"Configurations"),React.createElement("div",{className:"space-y-2 max-h-72 overflow-y-auto pr-1"},p.map(i=>React.createElement("button",{key:i.path,className:Q("w-full rounded border px-3 py-2 text-left text-sm",b&&b.path===i.path?"border-indigo-500 bg-indigo-900/40 text-indigo-100":"border-slate-800 bg-slate-950 text-slate-200 hover:border-indigo-600"),onClick:()=>x(i)},React.createElement("div",{className:"font-semibold"},i.name),React.createElement("div",{className:"text-xs text-slate-400"},"Updated ",i.updated_at?dayjs(i.updated_at).fromNow():"unknown"),Array.isArray(i.warnings)&&i.warnings.length>0&&React.createElement("div",{className:"mt-1 flex flex-wrap gap-1"},i.warnings.map((A,U)=>React.createElement("span",{key:U,className:"rounded bg-amber-900/30 px-2 py-0.5 text-[11px] text-amber-200"},A))))),p.length===0&&React.createElement("p",{className:"text-sm text-slate-500"},"No config files discovered."))),React.createElement("div",{className:"rounded-lg border border-slate-800 bg-slate-900/40 p-4"},b?React.createElement("div",{className:"space-y-3"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",null,React.createElement("div",{className:"text-sm font-semibold text-slate-100"},b.name),React.createElement("div",{className:"text-xs text-slate-400"},b.path)),React.createElement("div",{className:"flex items-center gap-2"},React.createElement("button",{className:"rounded bg-emerald-600 px-3 py-1 text-xs font-semibold text-white hover:bg-emerald-500 disabled:opacity-50",onClick:L,disabled:!k||y},"Save"),React.createElement("button",{className:"rounded bg-slate-800 px-3 py-1 text-xs text-slate-200 hover:bg-slate-700 disabled:opacity-50",onClick:E,disabled:y},"Revert"))),React.createElement("textarea",{className:"h-80 w-full rounded border border-slate-800 bg-slate-950 p-3 font-mono text-xs text-slate-100",value:s,onChange:i=>{h(i.target.value),v(!0)}})):React.createElement("p",{className:"text-sm text-slate-500"},"Select a configuration to view or edit its contents. Warnings from guardrails will appear once loaded.")))}function ze({data:t,strategyMetadata:o={},onClear:m,clearing:y=!1}){const p=Array.isArray(t.records)?t.records:[],b=t.stats||{},D=p.slice(-20).reverse(),s=o&&typeof o=="object"?o:{},h=a=>typeof a=="number"&&Number.isFinite(a)?a>0?"text-emerald-400":a<0?"text-rose-400":"text-slate-200":"text-slate-200",k=(a,c=2)=>typeof a=="number"&&Number.isFinite(a)?a.toLocaleString(void 0,{minimumFractionDigits:c,maximumFractionDigits:c}):"\u2014",v=(a,c=2)=>typeof a=="number"&&Number.isFinite(a)?`${a.toFixed(c)}%`:"\u2014",x=(a,c=2)=>typeof a=="number"&&Number.isFinite(a)?a.toLocaleString(void 0,{style:"currency",currency:"USD",minimumFractionDigits:c,maximumFractionDigits:c}):"\u2014",L=(a,c=2)=>typeof a=="number"&&Number.isFinite(a)?a.toLocaleString(void 0,{style:"currency",currency:"AUD",minimumFractionDigits:c,maximumFractionDigits:c}):"\u2014",E=(a,c,R=6)=>typeof a=="number"&&Number.isFinite(a)&&c&&typeof c=="string"&&c.length?`${a.toLocaleString(void 0,{minimumFractionDigits:R,maximumFractionDigits:R})} ${c}`:"\u2014",i=a=>{if(!a)return"\u2014";const c=String(a),R=c.replace(/\s+/g,"_").toLowerCase(),$=s[c]||s[c.toLowerCase()]||s[R]||null;return $&&$.label?$.label:c.replace(/_/g," ")},A=a=>{if(a==null||a==="")return{label:"Closed",tone:"closed"};if(a===!0)return{label:"Open",tone:"open"};if(a===!1)return{label:"Closed",tone:"closed"};const c=String(a).trim().toLowerCase();return c?["open","opened","opening","active"].includes(c)?{label:"Open",tone:"open"}:["closed","closing","flat","exit","exited"].includes(c)?{label:"Closed",tone:"closed"}:{label:c.replace(/\b\w/g,$=>$.toUpperCase()),tone:"neutral"}:{label:"Closed",tone:"closed"}},U=a=>{switch(a){case"open":return"border border-emerald-400/40 bg-emerald-500/15 text-emerald-300";case"closed":return"border border-slate-600/40 bg-slate-700/20 text-slate-200";default:return"border border-indigo-500/40 bg-indigo-500/15 text-indigo-200"}},I=Object.entries(b).map(([a,c])=>{const R=a.replace(/_/g," ").replace(/\b\w/g,V=>V.toUpperCase());let $="\u2014",Y="text-slate-100";if(typeof c=="number"&&Number.isFinite(c))switch(a){case"pnl_pct":$=v(c,2),Y=h(c);break;case"pnl_usd":$=x(c,2),Y=h(c);break;case"drawdown":$=v(c*100,2),Y=c>.3?"text-amber-300":"text-slate-100";break;case"win_rate":$=v(c*100,1);break;case"notional_usd":$=x(c,0);break;case"trades":$=Math.round(c).toLocaleString();break;case"sharpe":$=c.toFixed(3);break;default:$=c.toFixed(3)}return{key:a,label:R,value:$,className:Y}}),J=a=>{if(!a)return"\u2014";try{const c=dayjs(a);if(c.isValid())return c.format("YYYY-MM-DD HH:mm:ss")}catch{return a}return a};return React.createElement("div",{className:"space-y-4"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3"},I.map(({key:a,label:c,value:R,className:$})=>React.createElement("div",{key:a,className:"rounded bg-slate-900/60 px-3 py-2"},React.createElement("div",{className:"text-xs uppercase tracking-wide text-slate-400"},c),React.createElement("div",{className:Q("text-sm font-semibold",$)},R)))),React.createElement("div",{className:"flex items-center gap-2"},React.createElement("a",{href:"/api/trades/export",className:"rounded bg-emerald-600 px-3 py-2 text-xs font-semibold text-white hover:bg-emerald-500"},"Export CSV"),React.createElement("button",{type:"button",className:"rounded bg-slate-800 px-3 py-2 text-xs font-semibold text-slate-200 hover:bg-slate-700 disabled:cursor-not-allowed disabled:opacity-50",onClick:()=>typeof m=="function"?m():null,disabled:y||typeof m!="function"},y?"Clearing\u2026":"Clear log"))),React.createElement("div",{className:"rounded-lg border border-slate-800 bg-slate-900/50"},React.createElement("table",{className:"min-w-full divide-y divide-slate-800 text-xs"},React.createElement("thead",{className:"bg-slate-900/80 text-slate-300"},React.createElement("tr",null,React.createElement("th",{className:"px-3 py-2 text-left"},"Timestamp"),React.createElement("th",{className:"px-3 py-2 text-left"},"Strategy"),React.createElement("th",{className:"px-3 py-2 text-left"},"Symbol"),React.createElement("th",{className:"px-3 py-2 text-left"},"Timeframe"),React.createElement("th",{className:"px-3 py-2 text-left"},"Status"),React.createElement("th",{className:"px-3 py-2 text-right"},"PnL"),React.createElement("th",{className:"px-3 py-2 text-right"},"Confidence"),React.createElement("th",{className:"px-3 py-2 text-right"},"Volatility"),React.createElement("th",{className:"px-3 py-2 text-right"},"Size"))),React.createElement("tbody",{className:"divide-y divide-slate-800 text-slate-200"},D.length===0&&React.createElement("tr",null,React.createElement("td",{colSpan:"9",className:"px-3 py-3 text-center text-slate-500"},"No trades recorded yet.")),D.map((a,c)=>React.createElement("tr",{key:c},React.createElement("td",{className:"px-3 py-2"},J(a.timestamp)),React.createElement("td",{className:"px-3 py-2"},i(a.strategy||a.meta&&a.meta.strategy)),React.createElement("td",{className:"px-3 py-2"},a.symbol||"\u2014"),React.createElement("td",{className:"px-3 py-2"},a.timeframe||a.meta&&a.meta.timeframe||"\u2014"),React.createElement("td",{className:"px-3 py-2"},(()=>{const{label:R,tone:$}=A(a.status);return React.createElement("span",{className:Q("inline-flex items-center rounded px-2 py-0.5 text-[11px] font-semibold uppercase tracking-wide",U($))},R)})()),React.createElement("td",{className:"px-3 py-2 text-right"},(()=>{const R=typeof a.pnl_pct=="number"&&Number.isFinite(a.pnl_pct)?a.pnl_pct:null,$=typeof a.pnl_value_usd=="number"&&Number.isFinite(a.pnl_value_usd)?a.pnl_value_usd:typeof a.pnl=="number"?a.pnl:null,Y=typeof a.pnl_value_base=="number"&&Number.isFinite(a.pnl_value_base)?a.pnl_value_base:null,V=typeof a.pnl_value_aud=="number"&&Number.isFinite(a.pnl_value_aud)?a.pnl_value_aud:null,G=typeof a.symbol=="string"?a.symbol:"",ee=a.base_currency||(G?G.replace(/(USDT|USDC|USD|PERP)$/i,""):""),H=h(R!==null?R:$);return React.createElement("div",{className:"space-y-0.5"},React.createElement("div",{className:Q("font-semibold",H)},R!==null?v(R,2):x($,2)),React.createElement("div",{className:Q("text-[11px]",H,"opacity-80")},x($,2)),React.createElement("div",{className:Q("text-[11px]",H,"opacity-80")},E(Y,ee)),React.createElement("div",{className:Q("text-[11px]",H,"opacity-80")},L(V,2)))})()),React.createElement("td",{className:"px-3 py-2 text-right"},a.confidence!==void 0&&a.confidence!==null?Number(a.confidence).toFixed(3):"\u2014"),React.createElement("td",{className:"px-3 py-2 text-right"},a.volatility!==void 0&&a.volatility!==null?Number(a.volatility).toFixed(3):"\u2014"),React.createElement("td",{className:"px-3 py-2 text-right"},(()=>{const R=typeof a.position_size=="number"&&Number.isFinite(a.position_size)?a.position_size:null,$=typeof a.notional_usd=="number"&&Number.isFinite(a.notional_usd)?a.notional_usd:R,Y=typeof a.notional_base=="number"&&Number.isFinite(a.notional_base)?a.notional_base:null,V=typeof a.notional_aud=="number"&&Number.isFinite(a.notional_aud)?a.notional_aud:null,G=typeof a.symbol=="string"?a.symbol:"",ee=a.base_currency||(G?G.replace(/(USDT|USDC|USD|PERP)$/i,""):"");return React.createElement("div",{className:"space-y-0.5"},React.createElement("div",{className:"font-mono text-sm text-slate-200"},R!==null?k(R,2):"\u2014"),React.createElement("div",{className:"text-[11px] text-slate-400"},$!==null?x($,2):"\u2014"),React.createElement("div",{className:"text-[11px] text-slate-400"},E(Y,ee)),React.createElement("div",{className:"text-[11px] text-slate-400"},L(V,2)))})())))))))}function Je({data:t}){const o=t&&t.metrics||{},m=Array.isArray(t&&t.events)?t.events:[],y=t&&t.status||"idle",p=t&&t.heartbeat,b=Array.isArray(t&&t.active_modes)?t.active_modes:[],D=t&&t.last_event_at?t.last_event_at:o.last_event_at||null,s=Object.entries(o.by_stage||{}).map(([i,A])=>({stage:i,count:A})),h=Object.entries(o.by_strategy||{}).map(([i,A])=>({strategy:i,total:A.total||0,byStage:A.by_stage||{}})),k=i=>String(i||"unknown").replace(/_/g," ").replace(/\b\w/g,A=>A.toUpperCase()),v=y==="scanning"?`Scanning${b.length?` (${b.join(", ")})`:""}`:"Idle",x=y==="scanning"?"bg-emerald-900/40 text-emerald-200 border border-emerald-800/60":"bg-slate-800 text-slate-200 border border-slate-700",L=p?dayjs(p).fromNow():"No heartbeat yet",E=D?dayjs(D).fromNow():"Never";return React.createElement("div",{className:"rounded-lg border border-slate-800 bg-slate-900/40 p-4 space-y-4"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("h3",{className:"text-sm font-semibold uppercase tracking-wide text-slate-200"},"Decision telemetry"),React.createElement("div",{className:"flex items-center gap-2"},React.createElement("span",{className:"rounded-full bg-slate-800 px-2 py-0.5 text-xs font-semibold text-slate-200"},o.total_events||0," events"),React.createElement("span",{className:Q("rounded-full px-2 py-0.5 text-[11px] font-semibold",x)},v))),React.createElement("div",{className:"grid gap-3 md:grid-cols-2"},React.createElement("div",{className:"space-y-2"},React.createElement("div",{className:"text-xs font-semibold uppercase tracking-wide text-slate-400"},"By stage"),s.length?s.map(({stage:i,count:A})=>React.createElement("div",{key:i,className:"flex items-center justify-between rounded border border-slate-800 px-3 py-1 text-xs text-slate-200"},React.createElement("span",null,k(i)),React.createElement("span",{className:"font-mono text-slate-100"},A))):React.createElement("div",{className:"rounded border border-slate-800 px-3 py-2 text-xs text-slate-500"},"No decision events recorded yet.")),React.createElement("div",{className:"space-y-2"},React.createElement("div",{className:"text-xs font-semibold uppercase tracking-wide text-slate-400"},"By strategy"),h.length?h.map(({strategy:i,total:A,byStage:U})=>React.createElement("div",{key:i,className:"rounded border border-slate-800 px-3 py-2 text-xs text-slate-200 space-y-1"},React.createElement("div",{className:"flex items-center justify-between font-semibold"},React.createElement("span",null,i),React.createElement("span",{className:"font-mono text-slate-100"},A)),Object.keys(U).length>0&&React.createElement("div",{className:"grid grid-cols-2 gap-1 text-[11px] text-slate-400"},Object.entries(U).map(([I,J])=>React.createElement("div",{key:`${i}-${I}`,className:"flex items-center justify-between"},React.createElement("span",null,k(I)),React.createElement("span",{className:"font-mono text-slate-200"},J)))))):React.createElement("div",{className:"rounded border border-slate-800 px-3 py-2 text-xs text-slate-500"},"No strategy-level decisions observed."))),React.createElement("div",{className:"space-y-2"},React.createElement("div",{className:"text-xs font-semibold uppercase tracking-wide text-slate-400"},"Recent events"),React.createElement("div",{className:"max-h-56 overflow-y-auto divide-y divide-slate-800 rounded border border-slate-800 text-xs text-slate-200"},m.length?m.slice(0,20).map((i,A)=>React.createElement("div",{key:`${i.timestamp}-${A}`,className:"px-3 py-2 space-y-0.5"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("span",{className:"font-mono text-[11px] text-slate-400"},i.timestamp?dayjs(i.timestamp).format("YYYY-MM-DD HH:mm:ss"):"\u2014"),React.createElement("span",{className:"rounded-full bg-slate-800 px-2 py-0.5 text-[11px] font-semibold text-slate-200"},k(i.stage))),React.createElement("div",{className:"flex items-center justify-between"},React.createElement("span",null,"Strategy: ",i.strategy||"\u2014"),React.createElement("span",{className:"text-slate-400"},"Symbol: ",i.symbol||"\u2014")),i.details&&Object.keys(i.details).length>0&&React.createElement("div",{className:"text-[11px] text-slate-400"},"Details: ",JSON.stringify(i.details)))):React.createElement("div",{className:"px-3 py-4 space-y-1 text-slate-500"},React.createElement("div",null,"No events recorded yet."),React.createElement("div",{className:"text-[11px] text-slate-400"},"Scanner status: ",v,". Heartbeat ",L,". Last event ",E,".")))))}function Ge({state:t,onToggle:o}){const m=!!(t&&t.online_learning),y=!!(t&&t.periodic_retraining);return React.createElement("div",{className:"rounded-lg border border-slate-800 bg-slate-900/40 p-4 space-y-4"},React.createElement("h3",{className:"text-sm font-semibold uppercase tracking-wide text-slate-200"},"Learning & Adaptation"),React.createElement("div",{className:"flex flex-col gap-3 text-sm text-slate-200"},React.createElement("label",{className:"flex items-center justify-between gap-4"},React.createElement("span",null,React.createElement("span",{className:"font-semibold"},"Online learning"),React.createElement("span",{className:"ml-2 text-xs text-slate-400"},"Let the agent adjust parameters continuously while trading.")),React.createElement("button",{className:Q("rounded px-3 py-1 text-xs font-semibold",m?"bg-emerald-600 text-white":"bg-slate-800 text-slate-200"),onClick:()=>o({online_learning:!m})},m?"Enabled":"Disabled")),React.createElement("label",{className:"flex items-center justify-between gap-4"},React.createElement("span",null,React.createElement("span",{className:"font-semibold"},"Periodic retraining"),React.createElement("span",{className:"ml-2 text-xs text-slate-400"},"Schedule offline retraining cycles using the latest data.")),React.createElement("button",{className:Q("rounded px-3 py-1 text-xs font-semibold",y?"bg-emerald-600 text-white":"bg-slate-800 text-slate-200"),onClick:()=>o({periodic_retraining:!y})},y?"Enabled":"Disabled"))),React.createElement("div",{className:"rounded border border-slate-800 bg-slate-950/60 p-3 text-xs text-slate-400"},"TradingView webhook endpoint ready at ",React.createElement("code",null,"/api/feeds/alerts"),". Configure your TradingView alert payload with the shared secret from ",React.createElement("code",null,"TRADINGVIEW_SHARED_SECRET"),". Alerts are forwarded into Kafka and DuckDB for downstream learners."))}function Ve({state:t,onKillSwitch:o,onRestart:m,working:y}){const p=!!(t&&t.kill_switch),b=t&&t.drawdown_threshold?t.drawdown_threshold:null;return React.createElement("div",{className:"rounded-lg border border-slate-800 bg-slate-900/40 p-4 space-y-4"},React.createElement("h3",{className:"text-sm font-semibold uppercase tracking-wide text-slate-200"},"System controls"),React.createElement("div",{className:"flex flex-wrap items-center gap-3"},React.createElement("button",{className:Q("rounded px-4 py-2 text-sm font-semibold",p?"bg-red-700 text-white":"bg-emerald-600 text-white"),onClick:()=>o(!p),disabled:y},p?"Disable kill switch":"Enable kill switch"),React.createElement("button",{className:"rounded bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-500 disabled:opacity-60",onClick:m,disabled:y},"Restart orchestrator"),t&&t.last_restart&&React.createElement("span",{className:"text-xs text-slate-400"},"Last restart ",dayjs(t.last_restart).fromNow())),b!==null&&React.createElement("div",{className:"text-xs text-slate-400"},"Kill switch threshold: ",(b*100).toFixed(2),"% drawdown"))}function qe({status:t,onAction:o,working:m}){const y=t?t.manage_enabled!==!1:!0,p=!!(t&&t.running),b=t&&t.error,D=Array.isArray(t&&t.services)?t.services:[],s=D.length>0,h=t?t.available!==!1:!1,k=p?"bg-emerald-800/60 text-emerald-100 border border-emerald-500/60":"bg-red-900/50 text-red-200 border border-red-500/60",v=D.map((x,L)=>{const E=x.Service||x.Name||x.container||`service-${L}`,i=x.State||x.status||x.Status||"",A=x.Health||x.health||"";return React.createElement("div",{key:E,className:"flex items-center justify-between rounded border border-slate-800/60 px-3 py-1 text-xs"},React.createElement("span",{className:"font-medium text-slate-200"},E),React.createElement("span",{className:"text-slate-400"},i,A?` (${A})`:""))});return React.createElement("div",{className:"rounded-lg border border-slate-800 bg-slate-900/40 p-4 space-y-4"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("h3",{className:"text-sm font-semibold uppercase tracking-wide text-slate-200"},"Kafka & Feeds"),React.createElement("span",{className:Q("rounded-full px-2 py-0.5 text-xs font-semibold",k)},p?"Running":"Stopped")),!y&&React.createElement("div",{className:"rounded border border-slate-700 bg-slate-950/80 px-3 py-2 text-xs text-slate-300"},"RunBot is configured with ",React.createElement("code",null,"RUNBOT_SKIP_KAFKA=1"),", so automatic management is disabled."),b&&React.createElement("div",{className:"rounded border border-red-800 bg-red-900/40 px-3 py-2 text-xs text-red-100"},b),!h&&!b&&React.createElement("div",{className:"rounded border border-slate-700 bg-slate-950/80 px-3 py-2 text-xs text-slate-300"},"Compose file not detected yet. Start RunBot or configure the stack to enable management."),React.createElement("div",{className:"flex flex-wrap gap-2"},React.createElement("button",{className:"rounded bg-emerald-600 px-3 py-1.5 text-xs font-semibold text-white hover:bg-emerald-500 disabled:opacity-50",onClick:()=>o("start"),disabled:m||p||!y},"Start"),React.createElement("button",{className:"rounded bg-red-700 px-3 py-1.5 text-xs font-semibold text-white hover:bg-red-600 disabled:opacity-50",onClick:()=>o("stop"),disabled:m||!p||!y},"Stop"),React.createElement("button",{className:"rounded bg-slate-800 px-3 py-1.5 text-xs font-semibold text-slate-200 hover:bg-slate-700 disabled:opacity-50",onClick:()=>o("restart"),disabled:m||!y},"Restart")),React.createElement("div",{className:"space-y-2 text-xs text-slate-300"},s?v:React.createElement("p",{className:"text-slate-500"},"No container status reported yet.")))}function Ye(){const t=me("/api/strategies",Se,{strategies:[],portfolio:null,alerts:[]}),o=me("/api/system/state",Se,{state:{},alerts:[]}),m=me("/api/system/kafka",Se,{}),y=me("/api/trading/status",Se,{paper:{},live:{},guardrails:{},open_positions:{count:0,notional_usd:0,pnl_usd:0,symbols:{}}}),p=me("/api/backtests",he,{jobs:[],results:[],guardrail_logs:[],guardrail_snapshots:[]}),b=me("/api/configs",he,{configs:[]}),D=me("/api/trades?limit=400",he,{records:[],stats:{}}),s=me("/api/trades/metrics",he,{metrics:{total_events:0,by_stage:{},by_strategy:{}},events:[]}),h=pe(()=>Array.isArray(t.data&&t.data.strategies)?t.data.strategies:[],[t.data]),k=pe(()=>{const r=t.data&&t.data.manifest;return r&&typeof r=="object"?r:{}},[t.data]),v=pe(()=>{const r={};return Object.entries(k).forEach(([n,u])=>{if(!u||typeof u!="object")return;const g=Array.isArray(u.timeframes)?u.timeframes.map(String):[];r[n]={label:u.label||n,description:u.description||"",recommended_timeframes:g,default_timeframe:u.default||g[0]||""}}),h.forEach(n=>{if(!n||!n.strategy)return;const u=n.strategy,g=r[u]||{label:n.strategy_label||u,description:n.strategy_description||"",recommended_timeframes:[],default_timeframe:""},q=Array.isArray(n.recommended_timeframes)?n.recommended_timeframes.map(String):[],K=Array.isArray(g.recommended_timeframes)?g.recommended_timeframes.slice():[];if(q.forEach(W=>{K.includes(W)||K.push(W)}),g.recommended_timeframes=K,!g.default_timeframe){const W=n.default_timeframe||K[0];W&&(g.default_timeframe=W)}!g.label&&n.strategy_label&&(g.label=n.strategy_label),r[u]=g}),r},[k,h]),x=pe(()=>{const r=new Set(Object.keys(v));return r.size||h.forEach(n=>{n&&n.strategy&&r.add(n.strategy)}),!r.size&&b.data&&Array.isArray(b.data.configs)&&b.data.configs.forEach(n=>{if(n&&n.name){const u=n.name.replace(/\.[^.]+$/,"");r.add(u)}}),r.size||je.forEach(n=>r.add(n)),Array.from(r).sort((n,u)=>{const g=v[n]&&v[n].label||n,q=v[u]&&v[u].label||u;return g.localeCompare(q)})},[v,h,b.data]),L=pe(()=>{const r=new Set;return h.forEach(n=>{n&&n.symbol&&r.add(String(n.symbol).toUpperCase())}),r.size||Pe.forEach(n=>r.add(n)),Array.from(r).sort()},[h]),E=pe(()=>{const r=new Set(ke);h.forEach(u=>{u&&u.timeframe&&r.add(String(u.timeframe)),u&&Array.isArray(u.recommended_timeframes)&&u.recommended_timeframes.forEach(g=>r.add(String(g)))}),Object.values(v).forEach(u=>{u&&Array.isArray(u.recommended_timeframes)&&u.recommended_timeframes.forEach(g=>r.add(String(g)))});const n=u=>{const g=ke.indexOf(u);return g===-1?ke.length+u.charCodeAt(0):g};return Array.from(r).sort((u,g)=>{const q=n(u),K=n(g);return q===K?u.localeCompare(g):q-K})},[h,v]),i=pe(()=>Ce,[]),[A,U]=O(o.data&&o.data.state||{});Z(()=>{o.data&&o.data.state&&U(o.data.state)},[o.data]);const[I,J]=O([]),[a,c]=O({showUnderperforming:!1,minTrades:0,sortKey:"sharpe",sortDirection:"desc"}),[R,$]=O(!1),[Y,V]=O(!1),[G,ee]=O(!1),[H,oe]=O({paper:!1,live:!1,stop:null}),[te,se]=O(!1),[fe,de]=O(!1),[ne,be]=O(!1),S=ue((r,n="info")=>{J(u=>[...u,{id:`${Date.now()}-${Math.random().toString(16).slice(2)}`,level:n,text:r}])},[]),le=r=>{J(n=>n.filter(u=>u.id!==r))},[ae,d]=O({configured:!1}),[_,F]=O({api_key:"",api_secret:""}),[e,l]=O(!1),f=ue(async()=>{try{const r=await z("/api/exchanges/bitmex/credentials",{method:"GET"});r&&d(r)}catch(r){S(`Unable to load BitMEX credentials: ${r.message}`,"warning")}},[S]);Z(()=>{f()},[f]);const N=async()=>{if(!te)try{se(!0),await z("/api/trades/clear",{method:"POST"}),S("Trade log cleared.","success"),D.refresh(),s.refresh()}catch(r){S(`Clear failed: ${r.message}`,"critical")}finally{se(!1)}},w=async()=>{if(!fe)try{de(!0),await z("/api/backtests/jobs/clear",{method:"POST"}),S("Job queue cleared.","success"),p.refresh()}catch(r){S(`Clear job queue failed: ${r.message}`,"critical")}finally{de(!1)}},P=async()=>{if(!ne)try{be(!0),await z("/api/guardrails/clear",{method:"POST"}),S("Guardrail logs cleared.","success"),p.refresh()}catch(r){S(`Clear guardrail logs failed: ${r.message}`,"critical")}finally{be(!1)}},C=async r=>{if(!r||!r.config){S("No config available for promotion.","warning");return}try{const n=await z("/api/strategies/promote",{body:{config:r.config}});S("Strategy promoted successfully.","success"),t.refresh(),o.refresh(),p.refresh(),n&&n.summary&&n.summary.destination&&S(`Active config updated: ${n.summary.destination}`,"info")}catch(n){S(`Promotion failed: ${n.message}`,"critical")}},T=r=>{if(!r||!r.config){S("No config available to snapshot.","warning");return}S(`Snapshot stored for ${r.config}`,"info")},B=async(r,n)=>{const u=r==="paper"?"/api/trading/paper":"/api/trading/live";try{oe(W=>({...W,[r]:!0}));const g=await z(u,{body:n}),q=g&&g.message?g.message:`${r==="paper"?"Paper":"Live"} trading request submitted.`,K=g&&g.status==="ok"?"success":"info";if(S(q,K),g&&Array.isArray(g.launch_plan)&&g.launch_plan.length){const W=g.launch_plan.map(ve=>{const Ae=ve.strategy||"?",Ee=ve.timeframe||"?",Le=ve.symbol||"(default)";return`${Ae} @ ${Ee} (${Le})`}).join(", ");S(`Plan: ${W}`,"info")}g&&Array.isArray(g.details)&&g.details.length&&g.details.forEach(W=>S(W,"warning")),y.refresh()}catch(g){S(`${r==="paper"?"Paper":"Live"} trading failed: ${g.message}`,"critical")}finally{oe(g=>({...g,[r]:!1}))}},re=async r=>{try{oe(W=>({...W,stop:r||"all"}));const u=await z("/api/trading/stop",{body:r?{mode:r}:{}}),g=u&&u.status?u.status:"stopped",q=g==="stopped"?"success":"info",K=g==="stopped"?"Trading processes stopped.":`Stop response: ${g}`;S(K,q),y.refresh()}catch(n){S(`Stop request failed: ${n.message}`,"critical")}finally{oe(n=>({...n,stop:null}))}},ie=async r=>{try{V(!0);const n=await z("/api/backtests",{body:r}),u=n.job_ids||[];u.length?S(`Queued backtests: ${u.join(", ")}`,"success"):S("Backtest request acknowledged.","info");const g=Array.isArray(n.launch_plan)?n.launch_plan:[];if(g.length){const q=g.map(K=>{const W=K.strategy||"?",ve=K.timeframe||"?",Ae=Array.isArray(K.symbols)&&K.symbols.length?K.symbols.join("/"):"default";return`${W} @ ${ve} (${Ae})`}).join(", ");S(`Launch plan: ${q}`,"info")}Array.isArray(n.warnings)&&n.warnings.length&&n.warnings.forEach(q=>S(q,"warning")),p.refresh(),t.refresh()}catch(n){S(`Backtest launch failed: ${n.message}`,"critical")}finally{V(!1)}},M=async(r,n)=>{try{await z(`/api/configs/${encodeURIComponent(r.name)}`,{method:"PUT",body:{content:n}}),S(`Saved ${r.name}`,"success"),b.refresh()}catch(u){throw S(`Save failed: ${u.message}`,"critical"),u}},j=async r=>{try{await z(`/api/configs/${encodeURIComponent(r.name)}/revert`,{method:"POST"}),S(`Reverted ${r.name}`,"info"),b.refresh()}catch(n){throw S(`Revert failed: ${n.message}`,"critical"),n}},X=async r=>{try{const n=await z("/learning/toggle",{body:r});n&&n.state?U(n.state):U(u=>({...u,...r})),S("Learning settings updated.","success"),o.refresh()}catch(n){S(`Update failed: ${n.message}`,"critical")}},xe=async r=>{try{$(!0),await z("/api/system/kill-switch",{body:{armed:r}}),S(`Kill switch ${r?"armed":"disarmed"}.`,"success"),o.refresh(),t.refresh()}catch(n){S(`Kill switch failed: ${n.message}`,"critical")}finally{$(!1)}},ce=async()=>{try{$(!0);const r=await z("/api/system/restart",{body:{}});S(`Restarted orchestrator. Cancelled jobs: ${r.cancelled_jobs||0}`,"success"),o.refresh(),p.refresh(),t.refresh()}catch(r){S(`Restart failed: ${r.message}`,"critical")}finally{$(!1)}},Ne=async r=>{const n=r?r.charAt(0).toUpperCase()+r.slice(1):"Status";if(!G)try{ee(!0);const u=await z("/api/system/kafka",{body:{action:r}}),g=u&&u.success!==!1,q=u?.error||u?.start?.error||u?.stop?.error||u?.stderr||"",K=g?`Kafka ${n.toLowerCase()} request completed.`:`Kafka ${n.toLowerCase()} request encountered issues${q?`: ${q}`:""}.`;S(K,g?"success":"critical"),m.refresh(),o.refresh()}catch(u){S(`Kafka ${n.toLowerCase()} failed: ${u.message}`,"critical")}finally{ee(!1)}},ge=r=>n=>{const u=n.target.value;F(g=>({...g,[r]:u}))},we=async r=>{if(r.preventDefault(),e)return;const n=_.api_key.trim(),u=_.api_secret.trim();if(!n||!u){S("API key and secret are required.","warning");return}try{l(!0);const g=await z("/api/exchanges/bitmex/credentials",{method:"POST",body:{api_key:n,api_secret:u}});g&&(d(g),F({api_key:"",api_secret:""})),S("BitMEX credentials updated.","success")}catch(g){S(`Update failed: ${g.message}`,"critical")}finally{l(!1)}},ye=[...t.data&&t.data.alerts?t.data.alerts:[],...o.data&&o.data.alerts?o.data.alerts:[]],_e=y.data||{};if(_e.guardrails&&_e.guardrails.paper_is_recent===!1&&ye.push({level:"warning",message:"Paper trading session is stale. Run paper before going live."}),y.error){const r=y.error.message||String(y.error);ye.push({level:"critical",message:`Trading status error: ${r}`})}if(m.error){const r=m.error.message||String(m.error);ye.push({level:"critical",message:`Kafka status error: ${r}`})}const De=m.data||{};return React.createElement("div",{className:"flex min-h-screen flex-col bg-slate-950 text-slate-100"},React.createElement(Fe,{alerts:ye,messages:I,onDismiss:le}),React.createElement("main",{className:"mx-auto w-full max-w-7xl flex-1 space-y-10 px-4 py-8"},React.createElement("header",{className:"space-y-3"},React.createElement("h1",{className:"text-2xl font-semibold text-white"},"AI Trading Bot Control Center"),React.createElement("p",{className:"text-sm text-slate-400"},"Monitor live strategies, launch research jobs, and steer the adaptive learning loop across BitMEX symbols."),React.createElement(Oe,{portfolio:t.data&&t.data.portfolio})),React.createElement("section",{className:"space-y-4"},React.createElement("h2",{className:"text-lg font-semibold text-white"},"BitMEX API access"),React.createElement("div",{className:"space-y-4 rounded-lg border border-slate-800 bg-slate-900/60 p-4"},React.createElement("p",{className:"text-sm text-slate-300"},"Provide a BitMEX API key so the bot can download market data and place simulated or live orders. Use an API key with ",React.createElement("span",{className:"font-semibold text-white"},"Order/Trade")," permissions only (no withdrawal rights). If you rotate keys or switch accounts, submitting the form overwrites the existing credentials."),React.createElement("ul",{className:"list-disc space-y-1 pl-5 text-sm text-slate-300"},React.createElement("li",null,"Create the key under ",React.createElement("span",{className:"font-semibold"},'API Key Restrictions \u2192 \\"Order\\"'),"."),React.createElement("li",null,"Disable withdrawal permissions and keep the key scoped to the trading sub-account you intend to automate."),React.createElement("li",null,"You can remove or replace the key at any time by saving new values below.")),React.createElement("div",{className:"text-xs text-slate-400"},"Status:"," ",ae.configured?React.createElement("span",{className:"text-emerald-300"},"Configured ",ae.api_key_preview?`(key ${ae.api_key_preview})`:"",ae.updated_at?` \xB7 Updated ${dayjs(ae.updated_at).fromNow()}`:""):React.createElement("span",{className:"text-amber-300"},"Not configured")),React.createElement("form",{className:"space-y-3",onSubmit:we},React.createElement("div",null,React.createElement("label",{className:"text-xs uppercase tracking-wide text-slate-400"},"API key"),React.createElement("input",{type:"text",className:"mt-1 w-full rounded border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-white focus:border-indigo-500 focus:outline-none",value:_.api_key,onChange:ge("api_key"),placeholder:"BMEX123..."})),React.createElement("div",null,React.createElement("label",{className:"text-xs uppercase tracking-wide text-slate-400"},"API secret"),React.createElement("input",{type:"password",className:"mt-1 w-full rounded border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-white focus:border-indigo-500 focus:outline-none",value:_.api_secret,onChange:ge("api_secret"),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022"})),React.createElement("div",{className:"flex flex-wrap items-center gap-3 text-xs text-slate-400"},React.createElement("button",{type:"submit",className:"rounded bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-500 disabled:cursor-not-allowed disabled:opacity-60",disabled:e},ae.configured?"Overwrite credentials":"Save credentials"),React.createElement("span",null,"Saving replaces any previously stored key."))))),React.createElement("section",{className:"space-y-4"},React.createElement("h2",{className:"text-lg font-semibold text-white"},"Strategy monitoring"),React.createElement(Ue,{strategies:t.data&&t.data.strategies,filters:a,onFilterChange:c,onPromote:C,onSnapshot:T})),React.createElement("section",{className:"space-y-4"},React.createElement("h2",{className:"text-lg font-semibold text-white"},"Backtest management"),React.createElement(Ie,{data:p.data||{},onLaunch:ie,launching:Y,strategyOptions:x,strategyMetadata:v,symbolOptions:L,timeframeOptions:E,capitalOptions:i,onNotify:S,onRefresh:p.refresh,onClearJobs:w,clearingJobs:fe,onClearGuardrails:P,clearingGuardrails:ne})),React.createElement("section",{className:"space-y-4"},React.createElement("h2",{className:"text-lg font-semibold text-white"},"Execution control"),React.createElement(Me,{status:y.data||{},strategyOptions:x,strategyMetadata:v,symbolOptions:L,timeframeOptions:E,capitalOptions:i,onStartPaper:r=>B("paper",r),onStartLive:r=>B("live",r),onStop:re,onNotify:S,working:H})),React.createElement("section",{className:"grid gap-6 md:grid-cols-[2fr,1fr]"},React.createElement("div",{className:"space-y-4"},React.createElement("h2",{className:"text-lg font-semibold text-white"},"Trade log & rolling stats"),React.createElement(ze,{data:D.data||{},strategyMetadata:v,onClear:N,clearing:te}),React.createElement(Je,{data:s.data||{}})),React.createElement("div",{className:"space-y-4"},React.createElement(qe,{status:De,onAction:Ne,working:G}),React.createElement(Ve,{state:o.data&&o.data.state,onKillSwitch:xe,onRestart:ce,working:R}),React.createElement(Ge,{state:A,onToggle:X}))),React.createElement("section",{className:"space-y-4"},React.createElement("h2",{className:"text-lg font-semibold text-white"},"Configuration management"),React.createElement(Ke,{data:b.data||{configs:[]},onSave:M,onRevert:j,loading:b.loading}))))}const Te=document.getElementById("app-root");Te&&ReactDOM.createRoot(Te).render(React.createElement(Ye,null));})();
