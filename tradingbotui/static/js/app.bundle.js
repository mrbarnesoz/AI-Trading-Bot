(()=>{const{useState:M,useEffect:te,useMemo:de,useCallback:ue}=React;typeof dayjs<"u"&&typeof dayjs_plugin_relativeTime<"u"&&dayjs.extend(dayjs_plugin_relativeTime);const xe=8e3,be=15e3,ge=["1m","3m","5m","15m","30m","1h","2h","4h","6h","12h","1d"],ye=[5,10,15,20,25,50,75,100],Se=["XBTUSD","ETHUSD","SOLUSD","XRPUSD","ADAUSD","DOGEUSD"],ke=["trend_follow","mean_reversion","breakout","scalper","adaptive_meta"],Ce=[{name:"config.yaml",path:"config.yaml",warnings:[],updated_at:null}];function X(...t){return t.filter(Boolean).join(" ")}function oe(t,o=be,p=null){const[g,u]=M(p),[f,L]=M(null),[s,h]=M(!0),k=ue(async()=>{try{const y=await fetch(t,{credentials:"same-origin"});if(!y.ok)throw new Error(`Request failed (${y.status})`);const b=await y.json();u(b),L(null)}catch(y){console.error("Polling error for",t,y),(y&&typeof y.message=="string"?y.message:"").includes("(404)")?(u(p),L(null)):L(y)}finally{h(!1)}},[t]);return te(()=>{let y=!0;if(!y)return;if(k(),o<=0)return()=>{y=!1};const b=setInterval(k,o);return()=>{y=!1,clearInterval(b)}},[k,o]),{data:g,error:f,loading:s,refresh:k}}async function q(t,{method:o="POST",body:p=void 0}={}){const g={method:o,headers:{"Content-Type":"application/json"},credentials:"same-origin"};p!==void 0&&(g.body=JSON.stringify(p));const u=await fetch(t,g),f=await u.text(),L=f?f.trim():"";let s={};if(L)try{s=JSON.parse(L)}catch{console.warn("Non-JSON response from",t,L),s={raw:L}}if(!u.ok){const h=s&&s.error||s&&s.message||s&&s.raw||`Request failed (${u.status})`,k=s&&Array.isArray(s.details)&&s.details.length?s.details.join("; "):"",y=k?`${h}: ${k}`:h;throw new Error(y)}return s}function he(t){if(!t)return"";if(typeof dayjs>"u")return`Generated at ${t}`;const o=dayjs(t);return o.isValid()?`Generated ${o.fromNow()}`:`Generated at ${t}`}function Ae({alerts:t,messages:o,onDismiss:p}){const g=[];return Array.isArray(t)&&t.forEach((u,f)=>{g.push({id:`alert-${f}-${u.message}`,level:u.level||"info",text:u.message||JSON.stringify(u),sticky:!0})}),o.forEach(u=>{g.push(u)}),g.length?React.createElement("div",{className:"sticky top-0 z-30 shadow-lg"},g.map(u=>{const f=u.level==="critical"?"bg-red-900 border-red-500":u.level==="warning"?"bg-amber-900 border-amber-500":u.level==="success"?"bg-emerald-900 border-emerald-500":"bg-slate-800 border-slate-600";return React.createElement("div",{key:u.id,className:X("flex items-center justify-between px-4 py-2 border-b text-sm",f)},React.createElement("span",{className:"font-medium"},u.text),!u.sticky&&React.createElement("button",{className:"text-xs text-slate-200 hover:text-white",onClick:()=>p(u.id)},"Dismiss"))})):null}function $e({portfolio:t}){if(!t)return null;const o=[{label:"PnL (30d)",value:t.pnl_30d},{label:"Sharpe (30d)",value:t.sharpe},{label:"Drawdown",value:t.drawdown},{label:"Win Rate",value:t.win_rate},{label:"Trades",value:t.trades}].filter(p=>p.value!==void 0&&p.value!==null);return o.length?React.createElement("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3"},o.map(p=>React.createElement("div",{key:p.label,className:"rounded-lg bg-slate-800 px-3 py-2"},React.createElement("div",{className:"text-xs uppercase tracking-wide text-slate-400"},p.label),React.createElement("div",{className:"text-lg font-semibold"},typeof p.value=="number"?p.value.toFixed(3):p.value)))):null}function Te({strategies:t,filters:o,onFilterChange:p,onPromote:g,onSnapshot:u}){const f=de(()=>{if(!Array.isArray(t))return[];let s=t.slice();o.showUnderperforming&&(s=s.filter(k=>k.underperforming)),o.minTrades&&(s=s.filter(k=>(k.trades||0)>=o.minTrades));const h=o.sortKey||"sharpe";return s.sort((k,y)=>{const b=k[h]||0,j=y[h]||0;return o.sortDirection==="asc"?b-j:j-b}),s},[t,o]);if(!f.length)return React.createElement("div",{className:"rounded-lg border border-dashed border-slate-700 p-6 text-center text-slate-400"},"No strategy data available yet.");const L=f[0];return React.createElement("div",{className:"space-y-4"},React.createElement("div",{className:"flex flex-wrap items-center gap-3 justify-between"},React.createElement("div",{className:"flex flex-wrap gap-3"},React.createElement("label",{className:"flex items-center gap-2 text-sm text-slate-300"},React.createElement("input",{type:"checkbox",className:"rounded border-slate-500",checked:o.showUnderperforming,onChange:s=>p({...o,showUnderperforming:s.target.checked})}),"Underperforming only"),React.createElement("label",{className:"flex items-center gap-2 text-sm text-slate-300"},"Min trades",React.createElement("input",{type:"number",min:"0",className:"w-20 rounded bg-slate-900 px-2 py-1 text-right text-slate-200 border border-slate-700",value:o.minTrades,onChange:s=>p({...o,minTrades:Number(s.target.value)||0})})),React.createElement("label",{className:"flex items-center gap-2 text-sm text-slate-300"},"Sort",React.createElement("select",{className:"rounded bg-slate-900 px-2 py-1 border border-slate-700",value:o.sortKey,onChange:s=>p({...o,sortKey:s.target.value})},React.createElement("option",{value:"sharpe"},"Sharpe"),React.createElement("option",{value:"win_rate"},"Win Rate"),React.createElement("option",{value:"drawdown"},"Drawdown"),React.createElement("option",{value:"trades"},"Trades")),React.createElement("button",{className:"rounded bg-slate-800 px-2 py-1 text-xs border border-slate-700",onClick:()=>p({...o,sortDirection:o.sortDirection==="asc"?"desc":"asc"})},o.sortDirection==="asc"?"Asc":"Desc"))),L&&React.createElement("button",{className:"rounded bg-emerald-600 px-3 py-2 text-sm font-semibold text-white hover:bg-emerald-500",onClick:()=>g(L)},"Promote top candidate")),React.createElement("div",{className:"overflow-x-auto rounded-lg border border-slate-800"},React.createElement("table",{className:"min-w-full divide-y divide-slate-800 text-sm"},React.createElement("thead",{className:"bg-slate-900/80"},React.createElement("tr",null,React.createElement("th",{className:"px-3 py-2 text-left font-semibold text-slate-300"},"Strategy / Guidance"),React.createElement("th",{className:"px-3 py-2 text-left font-semibold text-slate-300"},"Symbol"),React.createElement("th",{className:"px-3 py-2 text-left font-semibold text-slate-300"},"Timeframe"),React.createElement("th",{className:"px-3 py-2 text-right font-semibold text-slate-300"},"Sharpe"),React.createElement("th",{className:"px-3 py-2 text-right font-semibold text-slate-300"},"Win %"),React.createElement("th",{className:"px-3 py-2 text-right font-semibold text-slate-300"},"Drawdown"),React.createElement("th",{className:"px-3 py-2 text-right font-semibold text-slate-300"},"Trades"),React.createElement("th",{className:"px-3 py-2 text-left font-semibold text-slate-300"},"Warnings"),React.createElement("th",{className:"px-3 py-2 text-right font-semibold text-slate-300"},"Actions"))),React.createElement("tbody",{className:"divide-y divide-slate-800"},f.map(s=>{const h=s.id||`${s.strategy}-${s.symbol}-${s.timeframe}`,k=s.underperforming,y=s.strategy_label||s.strategy,b=Array.isArray(s.recommended_timeframes)?s.recommended_timeframes:[],j=b.length?b.join(", "):"\u2014",D=s.default_timeframe||b[0]||"\u2014";return React.createElement("tr",{key:h,className:k?"bg-red-900/10":""},React.createElement("td",{className:"px-3 py-2 text-slate-200"},React.createElement("div",{className:"flex flex-col gap-1"},React.createElement("span",{className:"font-semibold text-slate-100"},y),React.createElement("span",{className:"text-[11px] uppercase tracking-wide text-slate-500"},"ID: ",s.strategy),React.createElement("div",{className:"text-[11px] text-slate-400"},React.createElement("span",{className:"font-medium text-slate-300"},"Default:")," ",D),React.createElement("div",{className:"text-[11px] text-slate-500"},React.createElement("span",{className:"font-medium text-slate-400"},"Recommended:")," ",j))),React.createElement("td",{className:"px-3 py-2 text-slate-300"},s.symbol||"\u2014"),React.createElement("td",{className:"px-3 py-2 text-slate-300",title:`Current: ${s.timeframe||"\u2014"} \u2022 Default: ${D} \u2022 Recommended: ${j}`},s.timeframe||"\u2014"),React.createElement("td",{className:"px-3 py-2 text-right text-slate-200"},s.sharpe!==void 0&&s.sharpe!==null?s.sharpe.toFixed(3):"\u2014"),React.createElement("td",{className:"px-3 py-2 text-right text-slate-200"},s.win_rate!==void 0&&s.win_rate!==null?(s.win_rate*100).toFixed(1)+"%":"\u2014"),React.createElement("td",{className:"px-3 py-2 text-right text-slate-200"},s.drawdown!==void 0&&s.drawdown!==null?(s.drawdown*100).toFixed(1)+"%":"\u2014"),React.createElement("td",{className:"px-3 py-2 text-right text-slate-200"},s.trades||0),React.createElement("td",{className:"px-3 py-2 text-slate-300"},Array.isArray(s.warnings)&&s.warnings.length>0?React.createElement("div",{className:"flex flex-wrap gap-1"},s.warnings.map((i,A)=>React.createElement("span",{key:A,className:"rounded bg-amber-900/40 px-2 py-0.5 text-xs text-amber-200"},i))):React.createElement("span",{className:"text-slate-500"},"\u2014")),React.createElement("td",{className:"px-3 py-2 text-right"},React.createElement("div",{className:"inline-flex items-center gap-2"},React.createElement("button",{className:"rounded bg-indigo-600 px-3 py-1 text-xs font-semibold text-white hover:bg-indigo-500",onClick:()=>g(s),disabled:!s.config,title:s.config||"No config path available"},"Promote"),React.createElement("button",{className:"rounded bg-slate-800 px-3 py-1 text-xs text-slate-200 hover:bg-slate-700",onClick:()=>u(s),disabled:!s.config},"Snapshot"))))})))))}function Le({preview:t,onClose:o}){if(!t)return null;const{job:p,results:g}=t,u=[];p?.strategy&&u.push(p.strategy),p?.timeframe&&u.push(p.timeframe),Array.isArray(p?.pairs)&&p.pairs.length?u.push(p.pairs.join(", ")):p?.pair&&u.push(p.pair);const f=u.length?u.join(" \u2022 "):p?.id,L=s=>{!s||typeof navigator>"u"||!navigator.clipboard||navigator.clipboard.writeText(s).catch(()=>{})};return React.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-950/80 px-4 py-8 backdrop-blur-sm"},React.createElement("div",{className:"max-h-[80vh] w-full max-w-4xl overflow-hidden rounded-lg border border-slate-800 bg-slate-950 shadow-2xl"},React.createElement("div",{className:"flex items-start justify-between gap-3 border-b border-slate-800 px-5 py-4"},React.createElement("div",{className:"space-y-1"},React.createElement("h3",{className:"text-lg font-semibold text-white"},"Backtest results"),f&&React.createElement("p",{className:"text-xs text-slate-400"},f)),React.createElement("button",{className:"rounded bg-slate-800 px-3 py-1.5 text-xs font-semibold text-slate-200 hover:bg-slate-700",onClick:o},"Close")),React.createElement("div",{className:"max-h-[65vh] overflow-y-auto px-5 py-4 space-y-4"},(!g||g.length===0)&&React.createElement("div",{className:"rounded border border-slate-800 bg-slate-900/60 px-4 py-6 text-center text-sm text-slate-400"},"No result artifacts matched this job yet."),g&&g.map(s=>{const h=s.metadata||{},k=s.summary||{},y=s.file||s.path||Math.random().toString(36).slice(2),j=[{label:"Sharpe",value:s.sharpe},{label:"Trades",value:s.trades},{label:"Return",value:s.return},{label:"Capital %",value:s.capital_pct},{label:"Symbol",value:h.symbol||h.pair},{label:"Timeframe",value:h.interval||h.timeframe},{label:"Strategy",value:h.strategy||h.mode}].filter(D=>D.value!==void 0&&D.value!==null&&D.value!=="");return React.createElement("div",{key:y,className:"space-y-2 rounded border border-slate-800 bg-slate-900/70 p-4"},React.createElement("div",{className:"flex flex-wrap items-start justify-between gap-3"},React.createElement("div",null,React.createElement("div",{className:"text-sm font-semibold text-slate-100"},s.file||"Result"),React.createElement("div",{className:"text-xs text-slate-500"},he(s.generated_at))),React.createElement("div",{className:"flex flex-wrap items-center gap-2 text-xs text-slate-300"},s.path&&React.createElement("button",{className:"rounded border border-slate-700 px-2 py-1 hover:bg-slate-800",onClick:()=>L(s.path)},"Copy path"),s.path&&React.createElement("a",{className:"rounded border border-slate-700 px-2 py-1 hover:bg-slate-800",href:`/api/backtests/results/${encodeURIComponent(s.file)}`,target:"_blank",rel:"noreferrer"},"Open JSON"))),j.length>0&&React.createElement("div",{className:"grid gap-2 text-xs text-slate-300 md:grid-cols-3"},j.map(D=>React.createElement("div",{key:D.label,className:"rounded bg-slate-950/60 px-3 py-2"},React.createElement("div",{className:"text-[10px] uppercase tracking-wide text-slate-500"},D.label),React.createElement("div",{className:"text-sm font-semibold text-slate-100"},typeof D.value=="number"?D.value.toFixed(4):D.value)))),k&&Object.keys(k).length>0&&React.createElement("details",{className:"rounded border border-slate-800 bg-slate-950/50"},React.createElement("summary",{className:"cursor-pointer px-3 py-2 text-xs font-semibold text-slate-200"},"Summary details"),React.createElement("pre",{className:"overflow-x-auto px-3 py-2 text-[11px] leading-relaxed text-slate-200"},JSON.stringify(k,null,2))))}))))}function De({data:t,onLaunch:o,launching:p,strategyOptions:g=[],strategyMetadata:u={},symbolOptions:f=[],timeframeOptions:L=[],capitalOptions:s=[],onNotify:h=()=>{},onRefresh:k=()=>{},onClearJobs:y=()=>{},clearingJobs:b=!1,onClearGuardrails:j=()=>{},clearingGuardrails:D=!1}){const[i,A]=M({strategies:[],symbols:[],timeframes:{},capital_pct:s[0]??ye[0]??10,start_date:"",end_date:""}),[O,I]=M(null),[J,a]=M(null),[c,P]=M(!1),[$,W]=M(null);te(()=>{!i.strategies.length&&g.length&&A(e=>({...e,strategies:[g[0]]}))},[g]),te(()=>{!i.symbols.length&&f.length&&A(e=>({...e,symbols:[f[0]]}))},[f]),te(()=>{s.length&&!s.includes(Number(i.capital_pct))&&A(e=>({...e,capital_pct:s[0]}))},[s]);const V=ue(e=>{if(!e)return"";const r=u[e];return r&&r.label||e},[u]),G=ue(e=>{if(!e)return[];const r=u[e]||{},x=Array.isArray(r.recommended_timeframes)&&r.recommended_timeframes.length?r.recommended_timeframes:L,N=Array.isArray(x)?x:[],w=new Set,E=[];return N.forEach(C=>{const T=String(C);w.has(T)||(w.add(T),E.push(T))}),E},[u,L]);te(()=>{const e=i.strategies;A(r=>{const x={...r.timeframes||{}},N=new Set(e);Object.keys(x).forEach(T=>{N.has(T)||delete x[T]}),e.forEach(T=>{const K=G(T);if(!K.length){delete x[T];return}const se=u[T]||{},ee=se&&se.default_timeframe&&K.includes(se.default_timeframe)?se.default_timeframe:K[0],B=r.timeframes?r.timeframes[T]:void 0;B&&K.includes(B)?x[T]=B:x[T]=ee});const w=r.timeframes||{};return Object.keys(x).length===Object.keys(w).length&&Object.entries(x).every(([T,K])=>w[T]===K)?r:{...r,timeframes:x}})},[i.strategies,u,L,G]);const Q=Array.isArray(t.guardrail_logs)?t.guardrail_logs:[],H=Array.isArray(t.guardrail_snapshots)?t.guardrail_snapshots:[],ne=Array.isArray(t.jobs)?t.jobs:[],Z=Array.isArray(t.results)?t.results:[],ae=ue(e=>{if(!e)return[];const r=(e.config||"").toLowerCase(),x=(e.strategy||"").toLowerCase(),N=(e.timeframe||"").toLowerCase(),w=Array.isArray(e.plan_summary)?e.plan_summary:[],E=new Set(w.map(R=>String(R.strategy||"").toLowerCase()).filter(R=>R)),C=new Set(w.map(R=>String(R.timeframe||"").toLowerCase()).filter(R=>R)),T=new Set(w.flatMap(R=>R.symbols||[]).map(R=>String(R).toUpperCase()).filter(R=>R));(Array.isArray(e.pairs)?e.pairs.map(R=>String(R).toUpperCase()):e.pair?[String(e.pair).toUpperCase()]:[]).forEach(R=>T.add(R));const se=R=>{const l=(R||"").toLowerCase();return l?E.size?E.has(l):x&&(l===x||l.includes(x)):!1},ee=R=>{const l=(R||"").toLowerCase();return C.size?l?C.has(l):!1:N?!R||l===N:!0};return Z.filter(R=>{if(!R||typeof R!="object")return!1;const l=(R.config||"").toLowerCase();if(r&&l&&l===r)return!0;const n=(R.file||"").toLowerCase();if(x&&n.includes(x))return!0;const m=R.metadata||{},v=(m.strategy||m.mode||"").toLowerCase(),z=(m.interval||m.timeframe||"").toLowerCase(),U=(m.symbol||m.pair||"").toUpperCase();return!!(v&&se(v)&&ee(z)||T.size&&U&&T.has(U)&&ee(z)||T.size&&n&&Array.from(T).some(pe=>n.includes(pe.toLowerCase())))})},[Z]),ce=e=>r=>{const x=r.target.value;A(N=>({...N,timeframes:{...N.timeframes||{},[e]:x}}))},ie=e=>r=>{const x=Array.from(r.target.selectedOptions).map(N=>N.value);A(N=>({...N,[e]:x}))},re=e=>r=>{const x=e==="capital_pct"?Number(r.target.value):r.target.value;A(N=>({...N,[e]:x}))},S=i.strategies.length>0&&i.strategies.every(e=>{const r=i.timeframes?i.timeframes[e]:"";return r?G(e).includes(r):!1})&&Number(i.capital_pct)>0,le=e=>{if(!e)return;const r=ae(e);if(!r.length){const x=Array.isArray(e.plan_summary)?e.plan_summary.map(w=>w.label||w.strategy).filter(Boolean):[],N=x.length>0?x.join(", "):e.strategy||e.id||"selection";h(`No matching backtest results found for ${N}.`,"warning");return}I({job:e,results:r})},me=async e=>{if(!e||!e.file){h("Result file reference missing.","warning");return}try{W(e.file);const r=await q(`/api/backtests/results/${encodeURIComponent(e.file)}`,{method:"GET"}),x=r&&r.metadata?r.metadata:{},N=e.identity||{},w={strategy:N.strategy||x.strategy||e.strategy,timeframe:x.interval||x.timeframe||e.timeframe,pairs:N.symbol?[N.symbol]:void 0,pair:N.symbol||x.symbol||x.pair,id:e.file};I({job:w,results:[{...r,file:e.file,path:e.path||r.path,generated_at:e.generated_at||r.generated_at}]})}catch(r){h(`Failed to open result: ${r.message}`,"critical")}finally{W(null)}},d=async()=>{if(!c)try{if(typeof window<"u"&&!window.confirm("Clear all recent results from the panel?"))return;P(!0),await q("/api/backtests/results",{method:"DELETE"}),h("Cleared latest results.","success"),typeof k=="function"&&k()}catch(e){h(`Failed to clear results: ${e.message}`,"critical")}finally{P(!1)}},_=async(e,r)=>{if(e&&(e.stopPropagation(),e.preventDefault()),!r||!r.id)return;const x=String(r.status||"").toLowerCase();if(!["completed","failed","stopped","cancelled"].includes(x)){h("Only completed or failed jobs can be archived.","warning");return}let w=!1;x==="completed"&&(w=typeof window<"u"&&window.confirm("Archive matching backtest result files as well?"));try{a(r.id);const E=await q(`/api/jobs/${encodeURIComponent(r.id)}/archive`,{method:"POST",body:{archive_results:w}}),C=Array.isArray(E.archived_results)?E.archived_results.length:0,T=C>0?`Archived job ${r.id} and moved ${C} result ${C===1?"file":"files"}.`:`Archived job ${r.id}.`;h(T,"success"),typeof k=="function"&&k()}catch(E){h(`Archive failed: ${E.message}`,"critical")}finally{a(null)}},F=async e=>{if(e.preventDefault(),!S)return;const r={};i.strategies.forEach(N=>{const w=i.timeframes?i.timeframes[N]:"";w&&(r[N]=w)});const x={strategies:i.strategies,symbols:i.symbols,capital_pct:Number(i.capital_pct)||0};if(Object.keys(r).length){x.timeframes=r;const N=i.strategies[0];N&&r[N]&&(x.timeframe=r[N])}i.start_date&&(x.start_date=i.start_date),i.end_date&&(x.end_date=i.end_date),await o(x),A(N=>({...N,start_date:"",end_date:""}))};return te(()=>{if(!O)return;const e=ae(O.job),r=Array.isArray(O.results)?O.results.map(w=>w?.path||w?.file||"").join("|"):"",x=e.map(w=>w?.path||w?.file||"").join("|");(Array.isArray(O.results)?O.results.length:0)===e.length&&r===x||I(w=>({...w,results:e}))},[Z,O,ae]),React.createElement("div",{className:"space-y-6"},React.createElement("form",{onSubmit:F,className:"grid gap-4 rounded-lg border border-slate-800 bg-slate-900/40 p-4 md:grid-cols-3"},React.createElement("div",{className:"md:col-span-1 space-y-2"},React.createElement("label",{className:"text-xs uppercase tracking-wide text-slate-400"},"Strategies"),React.createElement("select",{multiple:!0,className:"h-32 w-full rounded border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-200",value:i.strategies,onChange:ie("strategies")},g.map(e=>React.createElement("option",{key:e,value:e},V(e)))),React.createElement("p",{className:"text-xs text-slate-500"},"Select one or more strategies (Ctrl/Cmd + click for multi-select).")),React.createElement("div",{className:"md:col-span-1 space-y-2"},React.createElement("label",{className:"text-xs uppercase tracking-wide text-slate-400"},"Symbols"),React.createElement("select",{multiple:!0,className:"h-32 w-full rounded border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-200",value:i.symbols,onChange:ie("symbols")},f.map(e=>React.createElement("option",{key:e,value:e},e))),React.createElement("p",{className:"text-xs text-slate-500"},"Select the BitMEX symbols to include. Leave empty to use the strategy defaults.")),React.createElement("div",{className:"md:col-span-1 grid grid-cols-2 gap-3"},React.createElement("div",{className:"col-span-2 space-y-2"},React.createElement("label",{className:"text-xs uppercase tracking-wide text-slate-400"},"Timeframes"),i.strategies.length===0?React.createElement("p",{className:"text-xs text-slate-500"},"Select at least one strategy to view recommended timeframes."):React.createElement("div",{className:"space-y-2"},i.strategies.map(e=>{const r=G(e),x=i.timeframes&&i.timeframes[e]||"",N=V(e);return React.createElement("div",{key:e,className:"space-y-1"},React.createElement("div",{className:"text-[11px] uppercase tracking-wide text-slate-500"},N),r.length?React.createElement("select",{className:"w-full rounded border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-200",value:x,onChange:ce(e)},r.map(w=>React.createElement("option",{key:w,value:w},w))):React.createElement("div",{className:"rounded border border-amber-800/60 bg-amber-900/20 px-3 py-2 text-xs text-amber-200"},"No recommended timeframes available."))}))),React.createElement("div",{className:"space-y-2"},React.createElement("label",{className:"text-xs uppercase tracking-wide text-slate-400"},"Capital %"),React.createElement("select",{className:"w-full rounded border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-200",value:i.capital_pct,onChange:re("capital_pct")},s.map(e=>React.createElement("option",{key:e,value:e},e,"%")))),React.createElement("div",{className:"space-y-2"},React.createElement("label",{className:"text-xs uppercase tracking-wide text-slate-400"},"Start date"),React.createElement("input",{type:"date",className:"w-full rounded border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-200",value:i.start_date,onChange:re("start_date")})),React.createElement("div",{className:"space-y-2"},React.createElement("label",{className:"text-xs uppercase tracking-wide text-slate-400"},"End date"),React.createElement("input",{type:"date",className:"w-full rounded border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-200",value:i.end_date,onChange:re("end_date")}))),React.createElement("div",{className:"md:col-span-3 flex justify-end"},React.createElement("button",{type:"submit",className:"inline-flex items-center gap-2 rounded bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-500 disabled:opacity-60",disabled:p||!S},p?"Queueing...":"Launch backtest"))),React.createElement("div",{className:"grid gap-5 md:grid-cols-2"},React.createElement("div",{className:"space-y-2 rounded-lg border border-slate-800 bg-slate-900/50 p-4"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",null,React.createElement("h3",{className:"text-sm font-semibold text-slate-200 uppercase tracking-wide"},"Job queue"),React.createElement("p",{className:"text-xs text-slate-500"},"Double-click a job to open its recent backtest results.")),React.createElement("button",{type:"button",className:"rounded bg-slate-800 px-3 py-1.5 text-xs font-semibold text-slate-200 hover:bg-slate-700 disabled:cursor-not-allowed disabled:opacity-60",onClick:y,disabled:b},b?"Clearing\u2026":"Clear jobs")),React.createElement("div",{className:"space-y-3 max-h-72 overflow-y-auto pr-1"},ne.length===0&&React.createElement("p",{className:"text-sm text-slate-500"},"No queued jobs."),ne.map(e=>{const r=Array.isArray(e.plan_summary)?e.plan_summary:[],x=r.map(C=>C.label||C.strategy).filter(Boolean),N=r.map(C=>C.timeframe).filter((C,T,K)=>C&&K.indexOf(C)===T),w=r.flatMap(C=>C.symbols||[]).filter((C,T,K)=>K.indexOf(C)===T),E=r.length||(Array.isArray(e.plan)?e.plan.length:0);return React.createElement("div",{key:e.id,className:"rounded border border-slate-800 p-3",onDoubleClick:()=>le(e)},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",null,React.createElement("span",{className:"font-semibold text-slate-100"},e.type||"job"," \u2022 ",e.status||"unknown"),E>0&&React.createElement("span",{className:"ml-2 rounded bg-slate-800/70 px-2 py-0.5 text-[11px] font-semibold text-slate-300"},E," strategy",E===1?"":" combos")),React.createElement("span",{className:"text-xs text-slate-400",title:e.submitted_at||""},e.submitted_at?dayjs(e.submitted_at).fromNow():"")),React.createElement("div",{className:"mt-1 grid grid-cols-2 gap-1 text-xs text-slate-400"},x.length?React.createElement("div",{className:"col-span-2"},"Strategies: ",React.createElement("span",{className:"text-slate-200"},x.join(", "))):e.strategy&&React.createElement("div",null,"Strategy: ",e.strategy),N.length?React.createElement("div",{className:"col-span-2"},"Timeframes: ",React.createElement("span",{className:"text-slate-200"},N.join(", "))):e.timeframe&&React.createElement("div",null,"TF: ",e.timeframe),w.length?React.createElement("div",{className:"col-span-2"},"Symbols: ",React.createElement("span",{className:"text-slate-200"},w.join(", "))):e.pair&&React.createElement("div",null,"Pair: ",e.pair),e.capital_pct!==void 0&&React.createElement("div",null,"Capital %: ",e.capital_pct)),r.length>0&&React.createElement("div",{className:"mt-3 space-y-3 rounded border border-slate-800/70 bg-slate-950/30 px-3 py-2 text-xs text-slate-200"},r.map((C,T)=>React.createElement("div",{key:`${e.id}-${C.strategy}-${C.timeframe}-${T}`,className:"space-y-1"},React.createElement("div",{className:"font-semibold text-slate-100"},C.label||C.strategy," \u2022 ",C.timeframe||"\u2014"),React.createElement("div",{className:"text-slate-400"},C.entry_reason),React.createElement("div",{className:"text-slate-400"},"Exit plan: ",C.exit_reason)))),React.createElement("div",{className:"mt-2 flex flex-wrap gap-2 text-xs"},React.createElement("button",{className:"rounded bg-slate-800 px-3 py-1 font-semibold text-slate-200 hover:bg-slate-700 disabled:cursor-not-allowed disabled:opacity-50",onClick:C=>_(C,e),disabled:J===e.id||!["completed","failed","stopped","cancelled"].includes(String(e.status||"").toLowerCase())},J===e.id?"Archiving...":"Archive")),e.error&&React.createElement("div",{className:"mt-2 rounded bg-red-900/40 px-3 py-2 text-xs text-red-200"},e.error))}))),React.createElement("div",{className:"space-y-2 rounded-lg border border-slate-800 bg-slate-900/50 p-4"},React.createElement("div",{className:"flex items-center justify-between gap-3"},React.createElement("h3",{className:"text-sm font-semibold text-slate-200 uppercase tracking-wide"},"Latest results"),React.createElement("button",{type:"button",className:"rounded bg-slate-800 px-3 py-1.5 text-xs font-semibold text-slate-200 hover:bg-slate-700 disabled:cursor-not-allowed disabled:opacity-60",onClick:d,disabled:c||Z.length===0},c?"Clearing\u2026":"Clear")),React.createElement("div",{className:"space-y-3 max-h-72 overflow-y-auto pr-1"},Z.length===0&&React.createElement("p",{className:"text-sm text-slate-500"},"No results yet."),Z.map(e=>{const r=e.identity||{},x=e.summary||{},N=e.explanations||{},w=e.strategy_label||r.label||e.strategy||r.strategy||e.config||"Result",E=[],C=r.symbol||e.metadata&&(e.metadata.symbol||e.metadata.pair),T=r.timeframe||e.metadata&&(e.metadata.interval||e.metadata.timeframe);C&&E.push(C),T&&E.push(T),e.capital_pct&&E.push(`${e.capital_pct}% capital`);const K=[{label:"Sharpe",value:x.calc_sharpe??e.sharpe},{label:"Trades",value:x.trades_count??e.trades},{label:"Return",value:x.total_return??e.return},{label:"Max DD",value:x.max_drawdown}].filter(B=>B.value!==void 0&&B.value!==null&&B.value!==""&&!Number.isNaN(B.value)),se=N.entry,ee=N.exit;return React.createElement("div",{key:e.path||e.file||e.config,className:"rounded border border-slate-800 p-3"},React.createElement("div",{className:"flex items-start justify-between gap-3"},React.createElement("div",null,React.createElement("div",{className:"font-semibold text-slate-100"},w),E.length>0&&React.createElement("div",{className:"text-xs text-slate-400"},E.join(" \u2022 ")),he(e.generated_at)&&React.createElement("div",{className:"text-[11px] text-slate-500"},he(e.generated_at))),React.createElement("div",{className:"flex flex-wrap gap-2 text-xs text-slate-200"},React.createElement("button",{className:"rounded bg-slate-800 px-3 py-1 font-semibold hover:bg-slate-700 disabled:cursor-not-allowed disabled:opacity-60",onClick:()=>me(e),disabled:$===e.file||!e.file},$===e.file?"Opening\u2026":"View details"),e.file&&React.createElement("a",{className:"rounded border border-slate-700 px-3 py-1 hover:bg-slate-800",href:`/api/backtests/results/${encodeURIComponent(e.file)}`,target:"_blank",rel:"noreferrer"},"Open JSON"))),se&&React.createElement("p",{className:"mt-2 text-xs text-slate-300"},"Purpose: ",React.createElement("span",{className:"text-slate-100"},se)),ee&&React.createElement("p",{className:"text-xs text-slate-400"},"Exit plan: ",ee),K.length>0&&React.createElement("div",{className:"mt-2 grid gap-2 text-xs text-slate-300 sm:grid-cols-2"},K.map(B=>React.createElement("div",{key:B.label,className:"rounded bg-slate-950/50 px-2 py-1.5"},React.createElement("div",{className:"text-[10px] uppercase tracking-wide text-slate-500"},B.label),React.createElement("div",{className:"text-sm font-semibold text-slate-100"},typeof B.value=="number"?B.value.toFixed(4):B.value)))),Array.isArray(e.flags)&&e.flags.length>0&&React.createElement("div",{className:"mt-2 flex flex-wrap gap-1"},e.flags.map(B=>React.createElement("span",{key:B,className:"rounded bg-amber-900/30 px-2 py-0.5 text-xs text-amber-200"},B))))})))),React.createElement("div",{className:"grid gap-5 md:grid-cols-2"},React.createElement("div",{className:"rounded-lg border border-red-900/40 bg-red-950/40 p-4"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("h3",{className:"text-sm font-semibold uppercase tracking-wide text-red-200"},"Guardrail violations (latest)"),React.createElement("button",{type:"button",className:"rounded bg-red-900/60 px-3 py-1.5 text-xs font-semibold text-red-100 hover:bg-red-800 disabled:cursor-not-allowed disabled:opacity-60",onClick:j,disabled:D},D?"Clearing\u2026":"Clear logs")),React.createElement("div",{className:"mt-3 space-y-3 max-h-64 overflow-y-auto pr-1"},Q.length===0&&React.createElement("p",{className:"text-sm text-red-200/70"},"No guardrail breaches recorded."),Q.map((e,r)=>React.createElement("div",{key:r,className:"rounded border border-red-800/50 bg-red-900/30 p-3 text-sm"},React.createElement("div",{className:"flex items-center justify-between text-xs text-red-100/80"},React.createElement("span",null,e.rule||e.guardrail||"rule"),React.createElement("span",null,e.timestamp?dayjs(e.timestamp).format("YYYY-MM-DD HH:mm"):"")),e.message&&React.createElement("div",{className:"mt-1 text-red-100"},e.message),e.details&&React.createElement("pre",{className:"mt-2 overflow-x-auto rounded bg-red-900/40 p-2 text-[11px] text-red-100"},JSON.stringify(e.details,null,2)))))),React.createElement("div",{className:"rounded-lg border border-slate-800 bg-slate-900/60 p-4"},React.createElement("h3",{className:"text-sm font-semibold uppercase tracking-wide text-slate-200"},"Guardrail snapshots"),React.createElement("div",{className:"mt-3 space-y-3 max-h-64 overflow-y-auto pr-1 text-sm"},H.length===0&&React.createElement("p",{className:"text-slate-400"},"No snapshots captured yet."),H.map(e=>React.createElement("div",{key:e.path,className:"rounded border border-slate-800/80 p-3"},React.createElement("div",{className:"flex items-center justify-between text-xs text-slate-400"},React.createElement("span",null,e.name),React.createElement("span",null,e.created_at?dayjs(e.created_at).fromNow():"")),React.createElement("pre",{className:"mt-2 overflow-x-auto rounded bg-slate-950/60 p-2 text-[11px] text-slate-200"},JSON.stringify(e.summary,null,2))))))),O&&React.createElement(Le,{preview:O,onClose:()=>I(null)}))}function je({status:t={},strategyOptions:o=[],strategyMetadata:p={},symbolOptions:g=[],timeframeOptions:u=[],capitalOptions:f=[],onStartPaper:L,onStartLive:s,onStop:h,onNotify:k=()=>{},working:y={}}){const[b,j]=M({strategies:[],symbols:[],timeframes:{},capital_pct:f[0]??ye[0]??10});te(()=>{!b.strategies.length&&o.length&&j(d=>({...d,strategies:[o[0]]}))},[o]),te(()=>{!b.symbols.length&&g.length&&j(d=>({...d,symbols:[g[0]]}))},[g]),te(()=>{f.length&&!f.includes(Number(b.capital_pct))&&j(d=>({...d,capital_pct:f[0]}))},[f]);const D=ue(d=>{if(!d)return"";const _=p[d];return _&&_.label||d},[p]),i=ue(d=>{if(!d)return[];const _=p[d]||{},F=Array.isArray(_.recommended_timeframes)&&_.recommended_timeframes.length?_.recommended_timeframes:u,e=[],r=new Set;return(Array.isArray(F)?F:[]).forEach(x=>{const N=String(x);r.has(N)||(r.add(N),e.push(N))}),e.length?e:ge},[p,u]);te(()=>{const d=b.strategies;j(_=>{const F={..._.timeframes||{}},e=new Set(d);Object.keys(F).forEach(w=>{e.has(w)||delete F[w]}),d.forEach(w=>{const E=i(w);if(!E.length){delete F[w];return}const C=p[w]||{},T=C&&C.default_timeframe&&E.includes(C.default_timeframe)?C.default_timeframe:E[0],K=_.timeframes?_.timeframes[w]:void 0;K&&E.includes(K)?F[w]=K:F[w]=T});const r=_.timeframes||{};return Object.keys(F).length===Object.keys(r).length&&Object.entries(F).every(([w,E])=>r[w]===E)?_:{..._,timeframes:F}})},[b.strategies,p,i]);const A=d=>_=>{const F=Array.from(_.target.selectedOptions).map(e=>e.value);j(e=>({...e,[d]:F}))},O=d=>_=>{const F=d==="capital_pct"?Number(_.target.value):_.target.value;j(e=>({...e,[d]:F}))},I=t.paper||{},J=t.live||{},a=t.guardrails||{},c=t.open_positions||{},P=typeof c.notional_usd=="number"&&Number.isFinite(c.notional_usd)?c.notional_usd:null,$=typeof c.pnl_usd=="number"&&Number.isFinite(c.pnl_usd)?c.pnl_usd:null,W=P&&P!==0&&$!==null?$/Math.abs(P)*100:null,V=d=>{if(!d)return"Never";if(typeof dayjs>"u")return d;const _=dayjs(d);return _.isValid()?_.fromNow():d},G=(d,_=2)=>typeof d=="number"&&Number.isFinite(d)?d.toLocaleString(void 0,{style:"currency",currency:"USD",minimumFractionDigits:_,maximumFractionDigits:_}):"\u2014",Q=(d,_=2)=>typeof d=="number"&&Number.isFinite(d)?`${d.toFixed(_)}%`:"\u2014",H=d=>typeof d=="number"&&Number.isFinite(d)?d>0?"text-emerald-400":d<0?"text-rose-400":"text-slate-200":"text-slate-200",Z=b.strategies.length>0&&b.strategies.every(d=>{const _=b.timeframes?b.timeframes[d]:"";return _?i(d).includes(_):!1})&&Number(b.capital_pct)>0,ae=b.symbols&&b.symbols.length>0,ce={strategies:b.strategies,symbols:b.symbols.map(d=>String(d||"").toUpperCase()),timeframes:b.timeframes,capital_pct:Number(b.capital_pct)||0},ie=Z&&ae&&!I.running&&!I.pending&&!y.paper,re=Z&&ae&&a.paper_is_recent&&!J.running&&!J.pending&&!y.live,fe=()=>{if(!ie||typeof L!="function"){ae||k("Select at least one symbol to start paper trading.","warning");return}L(ce)},S=()=>{if(!re||typeof s!="function"){a.paper_is_recent?ae||k("Select at least one symbol before starting live trading.","warning"):k("Run a recent paper session before going live.","warning");return}s(ce)},le=y.stop||null,me=d=>()=>{typeof h=="function"&&h(d)};return React.createElement("div",{className:"space-y-4 rounded-lg border border-slate-800 bg-slate-900/40 p-4"},React.createElement("div",{className:"grid gap-6 md:grid-cols-[2fr,1fr]"},React.createElement("div",{className:"space-y-4"},React.createElement("div",{className:"grid gap-3 md:grid-cols-2"},React.createElement("div",{className:"space-y-2"},React.createElement("label",{className:"text-xs uppercase tracking-wide text-slate-400"},"Strategies"),React.createElement("select",{multiple:!0,className:"h-32 w-full rounded border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-200",value:b.strategies,onChange:A("strategies")},o.map(d=>React.createElement("option",{key:d,value:d},D(d)))),React.createElement("p",{className:"text-xs text-slate-500"},"Select one or more strategies to launch (Ctrl/Cmd + click).")),React.createElement("div",{className:"space-y-2"},React.createElement("label",{className:"text-xs uppercase tracking-wide text-slate-400"},"Symbols"),React.createElement("select",{multiple:!0,className:"h-32 w-full rounded border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-200",value:b.symbols,onChange:A("symbols")},g.map(d=>React.createElement("option",{key:d,value:d},d))),React.createElement("p",{className:"text-xs text-slate-500"},"Choose the trading pairs to launch sessions against.")),React.createElement("div",{className:"md:col-span-2 space-y-2"},React.createElement("label",{className:"text-xs uppercase tracking-wide text-slate-400"},"Timeframes"),b.strategies.length===0?React.createElement("p",{className:"text-xs text-slate-500"},"Select at least one strategy to configure timeframes."):React.createElement("div",{className:"grid gap-2 md:grid-cols-2"},b.strategies.map(d=>{const _=i(d),F=b.timeframes&&b.timeframes[d]||"",e=D(d);return React.createElement("div",{key:d,className:"space-y-1"},React.createElement("div",{className:"text-[11px] uppercase tracking-wide text-slate-500"},e),_.length?React.createElement("select",{className:"w-full rounded border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-200",value:F,onChange:r=>{const x=r.target.value;j(N=>({...N,timeframes:{...N.timeframes||{},[d]:x}}))}},_.map(r=>React.createElement("option",{key:r,value:r},r))):React.createElement("div",{className:"rounded border border-amber-800/60 bg-amber-900/20 px-3 py-2 text-xs text-amber-200"},"No recommended timeframes available."))}))),React.createElement("div",{className:"space-y-2"},React.createElement("label",{className:"text-xs uppercase tracking-wide text-slate-400"},"Capital %"),React.createElement("select",{className:"w-full rounded border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-200",value:b.capital_pct,onChange:O("capital_pct")},(f.length?f:ye).map(d=>React.createElement("option",{key:d,value:d},d,"%"))))),React.createElement("div",{className:"flex flex-wrap gap-3"},React.createElement("button",{className:"rounded bg-slate-200 px-4 py-2 text-sm font-semibold text-slate-900 hover:bg-white disabled:cursor-not-allowed disabled:opacity-60",onClick:fe,disabled:!ie},y.paper?"Starting paper...":"Start paper trading"),React.createElement("button",{className:"rounded bg-emerald-600 px-4 py-2 text-sm font-semibold text-white hover:bg-emerald-500 disabled:cursor-not-allowed disabled:opacity-60",onClick:S,disabled:!re},y.live?"Starting live...":"Start live trading"),React.createElement("button",{className:"rounded bg-slate-800 px-4 py-2 text-sm font-semibold text-slate-200 hover:bg-slate-700 disabled:cursor-not-allowed disabled:opacity-60",onClick:me("paper"),disabled:!I.running&&!I.pending||le==="paper"},le==="paper"?"Stopping paper...":"Stop paper"),React.createElement("button",{className:"rounded bg-slate-800 px-4 py-2 text-sm font-semibold text-slate-200 hover:bg-slate-700 disabled:cursor-not-allowed disabled:opacity-60",onClick:me("live"),disabled:!J.running&&!J.pending||le==="live"},le==="live"?"Stopping live...":"Stop live"),React.createElement("button",{className:"rounded bg-red-700 px-4 py-2 text-sm font-semibold text-white hover:bg-red-600 disabled:cursor-not-allowed disabled:opacity-60",onClick:me(void 0),disabled:le==="all"},le==="all"?"Stopping...":"Stop all")),!a.paper_is_recent&&React.createElement("div",{className:"rounded border border-amber-800 bg-amber-900/30 px-3 py-2 text-xs text-amber-100"},"Run a paper session (or rerun) before attempting live trading. Last paper: ",V(a.last_paper))),React.createElement("div",{className:"space-y-3 text-sm"},React.createElement("div",{className:"rounded border border-slate-800 bg-slate-950 px-3 py-3"},React.createElement("div",{className:"flex items-center justify-between text-xs uppercase tracking-wide text-slate-400"},React.createElement("span",null,"Paper status"),React.createElement("span",null,I.running?"running":I.pending?"starting":"idle")),React.createElement("div",{className:"mt-1 text-xs text-slate-300"},"Started: ",V(I.started_at)),React.createElement("div",{className:"text-xs text-slate-300"},"Last stop: ",V(I.ended_at))),React.createElement("div",{className:"rounded border border-slate-800 bg-slate-950 px-3 py-3"},React.createElement("div",{className:"flex items-center justify-between text-xs uppercase tracking-wide text-slate-400"},React.createElement("span",null,"Live status"),React.createElement("span",null,J.running?"running":J.pending?"starting":"idle")),React.createElement("div",{className:"mt-1 text-xs text-slate-300"},"Started: ",V(J.started_at)),React.createElement("div",{className:"text-xs text-slate-300"},"Last stop: ",V(J.ended_at))),React.createElement("div",{className:"rounded border border-slate-800 bg-slate-950 px-3 py-3"},React.createElement("div",{className:"text-xs uppercase tracking-wide text-slate-400"},"Open positions"),React.createElement("div",{className:"mt-2 space-y-1 text-xs text-slate-300"},React.createElement("div",null,"Count: ",c.count??0),React.createElement("div",null,"Exposure: ",G(c.notional_usd,0)),React.createElement("div",null,"PnL:"," ",React.createElement("span",{className:H(c.pnl_usd)},G(c.pnl_usd,2))),React.createElement("div",null,"Realised %:"," ",React.createElement("span",{className:H(W)},Q(W,2)))),c.symbols&&Object.keys(c.symbols).length>0&&React.createElement("div",{className:"mt-3 border-t border-slate-800 pt-2 text-xs text-slate-300"},React.createElement("div",{className:"mb-1 text-[11px] uppercase tracking-wide text-slate-500"},"By symbol"),React.createElement("div",{className:"space-y-1"},Object.entries(c.symbols).slice(0,6).map(([d,_])=>{const F=_&&typeof _.pnl_usd=="number"?_.pnl_usd:null,e=_&&typeof _.notional_usd=="number"?_.notional_usd:null,r=e&&e!==0&&F!==null?F/Math.abs(e)*100:null;return React.createElement("div",{key:d,className:"flex items-center justify-between rounded bg-slate-900/70 px-2 py-1"},React.createElement("div",{className:"font-mono text-[11px] text-slate-200"},d," \xB7 ",_&&_.count?_.count:0," pos"),React.createElement("div",{className:"flex items-center gap-2 text-[11px]"},React.createElement("span",{className:"text-slate-400"},G(e,0)),React.createElement("span",{className:H(F)},G(F,2)," (",Q(r,2),")")))}),Object.keys(c.symbols).length>6&&React.createElement("div",{className:"text-[11px] text-slate-500"},"Showing first 6 symbols. View the trade log for full detail.")))))))}function Ee({data:t,onSave:o,onRevert:p,loading:g}){let u=Array.isArray(t.configs)?t.configs.slice():[];u.length||(u=Ce);const[f,L]=M(null),[s,h]=M(""),[k,y]=M(!1);te(()=>{f||(h(""),y(!1))},[f]);const b=async i=>{const A=await q(`/api/configs/${encodeURIComponent(i.name)}`,{method:"GET"});L(i),h(A.content||""),y(!1)},j=async()=>{f&&(await o(f,s),y(!1))},D=async()=>{f&&(await p(f),L(null),h(""))};return React.createElement("div",{className:"grid gap-4 md:grid-cols-[260px,1fr]"},React.createElement("div",{className:"rounded-lg border border-slate-800 bg-slate-900/60 p-3"},React.createElement("div",{className:"mb-3 text-xs font-semibold uppercase tracking-wide text-slate-400"},"Configurations"),React.createElement("div",{className:"space-y-2 max-h-72 overflow-y-auto pr-1"},u.map(i=>React.createElement("button",{key:i.path,className:X("w-full rounded border px-3 py-2 text-left text-sm",f&&f.path===i.path?"border-indigo-500 bg-indigo-900/40 text-indigo-100":"border-slate-800 bg-slate-950 text-slate-200 hover:border-indigo-600"),onClick:()=>b(i)},React.createElement("div",{className:"font-semibold"},i.name),React.createElement("div",{className:"text-xs text-slate-400"},"Updated ",i.updated_at?dayjs(i.updated_at).fromNow():"unknown"),Array.isArray(i.warnings)&&i.warnings.length>0&&React.createElement("div",{className:"mt-1 flex flex-wrap gap-1"},i.warnings.map((A,O)=>React.createElement("span",{key:O,className:"rounded bg-amber-900/30 px-2 py-0.5 text-[11px] text-amber-200"},A))))),u.length===0&&React.createElement("p",{className:"text-sm text-slate-500"},"No config files discovered."))),React.createElement("div",{className:"rounded-lg border border-slate-800 bg-slate-900/40 p-4"},f?React.createElement("div",{className:"space-y-3"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",null,React.createElement("div",{className:"text-sm font-semibold text-slate-100"},f.name),React.createElement("div",{className:"text-xs text-slate-400"},f.path)),React.createElement("div",{className:"flex items-center gap-2"},React.createElement("button",{className:"rounded bg-emerald-600 px-3 py-1 text-xs font-semibold text-white hover:bg-emerald-500 disabled:opacity-50",onClick:j,disabled:!k||g},"Save"),React.createElement("button",{className:"rounded bg-slate-800 px-3 py-1 text-xs text-slate-200 hover:bg-slate-700 disabled:opacity-50",onClick:D,disabled:g},"Revert"))),React.createElement("textarea",{className:"h-80 w-full rounded border border-slate-800 bg-slate-950 p-3 font-mono text-xs text-slate-100",value:s,onChange:i=>{h(i.target.value),y(!0)}})):React.createElement("p",{className:"text-sm text-slate-500"},"Select a configuration to view or edit its contents. Warnings from guardrails will appear once loaded.")))}function Re({data:t,strategyMetadata:o={},onClear:p,clearing:g=!1}){const u=Array.isArray(t.records)?t.records:[],f=t.stats||{},L=u.slice(-20).reverse(),s=o&&typeof o=="object"?o:{},h=a=>typeof a=="number"&&Number.isFinite(a)?a>0?"text-emerald-400":a<0?"text-rose-400":"text-slate-200":"text-slate-200",k=(a,c=2)=>typeof a=="number"&&Number.isFinite(a)?a.toLocaleString(void 0,{minimumFractionDigits:c,maximumFractionDigits:c}):"\u2014",y=(a,c=2)=>typeof a=="number"&&Number.isFinite(a)?`${a.toFixed(c)}%`:"\u2014",b=(a,c=2)=>typeof a=="number"&&Number.isFinite(a)?a.toLocaleString(void 0,{style:"currency",currency:"USD",minimumFractionDigits:c,maximumFractionDigits:c}):"\u2014",j=(a,c=2)=>typeof a=="number"&&Number.isFinite(a)?a.toLocaleString(void 0,{style:"currency",currency:"AUD",minimumFractionDigits:c,maximumFractionDigits:c}):"\u2014",D=(a,c,P=6)=>typeof a=="number"&&Number.isFinite(a)&&c&&typeof c=="string"&&c.length?`${a.toLocaleString(void 0,{minimumFractionDigits:P,maximumFractionDigits:P})} ${c}`:"\u2014",i=a=>{if(!a)return"\u2014";const c=String(a),P=c.replace(/\s+/g,"_").toLowerCase(),$=s[c]||s[c.toLowerCase()]||s[P]||null;return $&&$.label?$.label:c.replace(/_/g," ")},A=a=>{if(a==null||a==="")return{label:"Closed",tone:"closed"};if(a===!0)return{label:"Open",tone:"open"};if(a===!1)return{label:"Closed",tone:"closed"};const c=String(a).trim().toLowerCase();return c?["open","opened","opening","active"].includes(c)?{label:"Open",tone:"open"}:["closed","closing","flat","exit","exited"].includes(c)?{label:"Closed",tone:"closed"}:{label:c.replace(/\b\w/g,$=>$.toUpperCase()),tone:"neutral"}:{label:"Closed",tone:"closed"}},O=a=>{switch(a){case"open":return"border border-emerald-400/40 bg-emerald-500/15 text-emerald-300";case"closed":return"border border-slate-600/40 bg-slate-700/20 text-slate-200";default:return"border border-indigo-500/40 bg-indigo-500/15 text-indigo-200"}},I=Object.entries(f).map(([a,c])=>{const P=a.replace(/_/g," ").replace(/\b\w/g,V=>V.toUpperCase());let $="\u2014",W="text-slate-100";if(typeof c=="number"&&Number.isFinite(c))switch(a){case"pnl_pct":$=y(c,2),W=h(c);break;case"pnl_usd":$=b(c,2),W=h(c);break;case"drawdown":$=y(c*100,2),W=c>.3?"text-amber-300":"text-slate-100";break;case"win_rate":$=y(c*100,1);break;case"notional_usd":$=b(c,0);break;case"trades":$=Math.round(c).toLocaleString();break;case"sharpe":$=c.toFixed(3);break;default:$=c.toFixed(3)}return{key:a,label:P,value:$,className:W}}),J=a=>{if(!a)return"\u2014";try{const c=dayjs(a);if(c.isValid())return c.format("YYYY-MM-DD HH:mm:ss")}catch{return a}return a};return React.createElement("div",{className:"space-y-4"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3"},I.map(({key:a,label:c,value:P,className:$})=>React.createElement("div",{key:a,className:"rounded bg-slate-900/60 px-3 py-2"},React.createElement("div",{className:"text-xs uppercase tracking-wide text-slate-400"},c),React.createElement("div",{className:X("text-sm font-semibold",$)},P)))),React.createElement("div",{className:"flex items-center gap-2"},React.createElement("a",{href:"/api/trades/export",className:"rounded bg-emerald-600 px-3 py-2 text-xs font-semibold text-white hover:bg-emerald-500"},"Export CSV"),React.createElement("button",{type:"button",className:"rounded bg-slate-800 px-3 py-2 text-xs font-semibold text-slate-200 hover:bg-slate-700 disabled:cursor-not-allowed disabled:opacity-50",onClick:()=>typeof p=="function"?p():null,disabled:g||typeof p!="function"},g?"Clearing\u2026":"Clear log"))),React.createElement("div",{className:"rounded-lg border border-slate-800 bg-slate-900/50"},React.createElement("table",{className:"min-w-full divide-y divide-slate-800 text-xs"},React.createElement("thead",{className:"bg-slate-900/80 text-slate-300"},React.createElement("tr",null,React.createElement("th",{className:"px-3 py-2 text-left"},"Timestamp"),React.createElement("th",{className:"px-3 py-2 text-left"},"Strategy"),React.createElement("th",{className:"px-3 py-2 text-left"},"Symbol"),React.createElement("th",{className:"px-3 py-2 text-left"},"Timeframe"),React.createElement("th",{className:"px-3 py-2 text-left"},"Status"),React.createElement("th",{className:"px-3 py-2 text-right"},"PnL"),React.createElement("th",{className:"px-3 py-2 text-right"},"Confidence"),React.createElement("th",{className:"px-3 py-2 text-right"},"Volatility"),React.createElement("th",{className:"px-3 py-2 text-right"},"Size"))),React.createElement("tbody",{className:"divide-y divide-slate-800 text-slate-200"},L.length===0&&React.createElement("tr",null,React.createElement("td",{colSpan:"9",className:"px-3 py-3 text-center text-slate-500"},"No trades recorded yet.")),L.map((a,c)=>React.createElement("tr",{key:c},React.createElement("td",{className:"px-3 py-2"},J(a.timestamp)),React.createElement("td",{className:"px-3 py-2"},i(a.strategy||a.meta&&a.meta.strategy)),React.createElement("td",{className:"px-3 py-2"},a.symbol||"\u2014"),React.createElement("td",{className:"px-3 py-2"},a.timeframe||a.meta&&a.meta.timeframe||"\u2014"),React.createElement("td",{className:"px-3 py-2"},(()=>{const{label:P,tone:$}=A(a.status);return React.createElement("span",{className:X("inline-flex items-center rounded px-2 py-0.5 text-[11px] font-semibold uppercase tracking-wide",O($))},P)})()),React.createElement("td",{className:"px-3 py-2 text-right"},(()=>{const P=typeof a.pnl_pct=="number"&&Number.isFinite(a.pnl_pct)?a.pnl_pct:null,$=typeof a.pnl_value_usd=="number"&&Number.isFinite(a.pnl_value_usd)?a.pnl_value_usd:typeof a.pnl=="number"?a.pnl:null,W=typeof a.pnl_value_base=="number"&&Number.isFinite(a.pnl_value_base)?a.pnl_value_base:null,V=typeof a.pnl_value_aud=="number"&&Number.isFinite(a.pnl_value_aud)?a.pnl_value_aud:null,G=typeof a.symbol=="string"?a.symbol:"",Q=a.base_currency||(G?G.replace(/(USDT|USDC|USD|PERP)$/i,""):""),H=h(P!==null?P:$);return React.createElement("div",{className:"space-y-0.5"},React.createElement("div",{className:X("font-semibold",H)},P!==null?y(P,2):b($,2)),React.createElement("div",{className:X("text-[11px]",H,"opacity-80")},b($,2)),React.createElement("div",{className:X("text-[11px]",H,"opacity-80")},D(W,Q)),React.createElement("div",{className:X("text-[11px]",H,"opacity-80")},j(V,2)))})()),React.createElement("td",{className:"px-3 py-2 text-right"},a.confidence!==void 0&&a.confidence!==null?Number(a.confidence).toFixed(3):"\u2014"),React.createElement("td",{className:"px-3 py-2 text-right"},a.volatility!==void 0&&a.volatility!==null?Number(a.volatility).toFixed(3):"\u2014"),React.createElement("td",{className:"px-3 py-2 text-right"},(()=>{const P=typeof a.position_size=="number"&&Number.isFinite(a.position_size)?a.position_size:null,$=typeof a.notional_usd=="number"&&Number.isFinite(a.notional_usd)?a.notional_usd:P,W=typeof a.notional_base=="number"&&Number.isFinite(a.notional_base)?a.notional_base:null,V=typeof a.notional_aud=="number"&&Number.isFinite(a.notional_aud)?a.notional_aud:null,G=typeof a.symbol=="string"?a.symbol:"",Q=a.base_currency||(G?G.replace(/(USDT|USDC|USD|PERP)$/i,""):"");return React.createElement("div",{className:"space-y-0.5"},React.createElement("div",{className:"font-mono text-sm text-slate-200"},P!==null?k(P,2):"\u2014"),React.createElement("div",{className:"text-[11px] text-slate-400"},$!==null?b($,2):"\u2014"),React.createElement("div",{className:"text-[11px] text-slate-400"},D(W,Q)),React.createElement("div",{className:"text-[11px] text-slate-400"},j(V,2)))})())))))))}function Pe({data:t}){const o=t&&t.metrics||{},p=Array.isArray(t&&t.events)?t.events:[],g=t&&t.status||"idle",u=t&&t.heartbeat,f=Array.isArray(t&&t.active_modes)?t.active_modes:[],L=t&&t.last_event_at?t.last_event_at:o.last_event_at||null,s=Object.entries(o.by_stage||{}).map(([i,A])=>({stage:i,count:A})),h=Object.entries(o.by_strategy||{}).map(([i,A])=>({strategy:i,total:A.total||0,byStage:A.by_stage||{}})),k=i=>String(i||"unknown").replace(/_/g," ").replace(/\b\w/g,A=>A.toUpperCase()),y=g==="scanning"?`Scanning${f.length?` (${f.join(", ")})`:""}`:"Idle",b=g==="scanning"?"bg-emerald-900/40 text-emerald-200 border border-emerald-800/60":"bg-slate-800 text-slate-200 border border-slate-700",j=u?dayjs(u).fromNow():"No heartbeat yet",D=L?dayjs(L).fromNow():"Never";return React.createElement("div",{className:"rounded-lg border border-slate-800 bg-slate-900/40 p-4 space-y-4"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("h3",{className:"text-sm font-semibold uppercase tracking-wide text-slate-200"},"Decision telemetry"),React.createElement("div",{className:"flex items-center gap-2"},React.createElement("span",{className:"rounded-full bg-slate-800 px-2 py-0.5 text-xs font-semibold text-slate-200"},o.total_events||0," events"),React.createElement("span",{className:X("rounded-full px-2 py-0.5 text-[11px] font-semibold",b)},y))),React.createElement("div",{className:"grid gap-3 md:grid-cols-2"},React.createElement("div",{className:"space-y-2"},React.createElement("div",{className:"text-xs font-semibold uppercase tracking-wide text-slate-400"},"By stage"),s.length?s.map(({stage:i,count:A})=>React.createElement("div",{key:i,className:"flex items-center justify-between rounded border border-slate-800 px-3 py-1 text-xs text-slate-200"},React.createElement("span",null,k(i)),React.createElement("span",{className:"font-mono text-slate-100"},A))):React.createElement("div",{className:"rounded border border-slate-800 px-3 py-2 text-xs text-slate-500"},"No decision events recorded yet.")),React.createElement("div",{className:"space-y-2"},React.createElement("div",{className:"text-xs font-semibold uppercase tracking-wide text-slate-400"},"By strategy"),h.length?h.map(({strategy:i,total:A,byStage:O})=>React.createElement("div",{key:i,className:"rounded border border-slate-800 px-3 py-2 text-xs text-slate-200 space-y-1"},React.createElement("div",{className:"flex items-center justify-between font-semibold"},React.createElement("span",null,i),React.createElement("span",{className:"font-mono text-slate-100"},A)),Object.keys(O).length>0&&React.createElement("div",{className:"grid grid-cols-2 gap-1 text-[11px] text-slate-400"},Object.entries(O).map(([I,J])=>React.createElement("div",{key:`${i}-${I}`,className:"flex items-center justify-between"},React.createElement("span",null,k(I)),React.createElement("span",{className:"font-mono text-slate-200"},J)))))):React.createElement("div",{className:"rounded border border-slate-800 px-3 py-2 text-xs text-slate-500"},"No strategy-level decisions observed."))),React.createElement("div",{className:"space-y-2"},React.createElement("div",{className:"text-xs font-semibold uppercase tracking-wide text-slate-400"},"Recent events"),React.createElement("div",{className:"max-h-56 overflow-y-auto divide-y divide-slate-800 rounded border border-slate-800 text-xs text-slate-200"},p.length?p.slice(0,20).map((i,A)=>React.createElement("div",{key:`${i.timestamp}-${A}`,className:"px-3 py-2 space-y-0.5"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("span",{className:"font-mono text-[11px] text-slate-400"},i.timestamp?dayjs(i.timestamp).format("YYYY-MM-DD HH:mm:ss"):"\u2014"),React.createElement("span",{className:"rounded-full bg-slate-800 px-2 py-0.5 text-[11px] font-semibold text-slate-200"},k(i.stage))),React.createElement("div",{className:"flex items-center justify-between"},React.createElement("span",null,"Strategy: ",i.strategy||"\u2014"),React.createElement("span",{className:"text-slate-400"},"Symbol: ",i.symbol||"\u2014")),i.details&&Object.keys(i.details).length>0&&React.createElement("div",{className:"text-[11px] text-slate-400"},"Details: ",JSON.stringify(i.details)))):React.createElement("div",{className:"px-3 py-4 space-y-1 text-slate-500"},React.createElement("div",null,"No events recorded yet."),React.createElement("div",{className:"text-[11px] text-slate-400"},"Scanner status: ",y,". Heartbeat ",j,". Last event ",D,".")))))}function Fe({state:t,onToggle:o}){const p=!!(t&&t.online_learning),g=!!(t&&t.periodic_retraining);return React.createElement("div",{className:"rounded-lg border border-slate-800 bg-slate-900/40 p-4 space-y-4"},React.createElement("h3",{className:"text-sm font-semibold uppercase tracking-wide text-slate-200"},"Learning & Adaptation"),React.createElement("div",{className:"flex flex-col gap-3 text-sm text-slate-200"},React.createElement("label",{className:"flex items-center justify-between gap-4"},React.createElement("span",null,React.createElement("span",{className:"font-semibold"},"Online learning"),React.createElement("span",{className:"ml-2 text-xs text-slate-400"},"Let the agent adjust parameters continuously while trading.")),React.createElement("button",{className:X("rounded px-3 py-1 text-xs font-semibold",p?"bg-emerald-600 text-white":"bg-slate-800 text-slate-200"),onClick:()=>o({online_learning:!p})},p?"Enabled":"Disabled")),React.createElement("label",{className:"flex items-center justify-between gap-4"},React.createElement("span",null,React.createElement("span",{className:"font-semibold"},"Periodic retraining"),React.createElement("span",{className:"ml-2 text-xs text-slate-400"},"Schedule offline retraining cycles using the latest data.")),React.createElement("button",{className:X("rounded px-3 py-1 text-xs font-semibold",g?"bg-emerald-600 text-white":"bg-slate-800 text-slate-200"),onClick:()=>o({periodic_retraining:!g})},g?"Enabled":"Disabled"))),React.createElement("div",{className:"rounded border border-slate-800 bg-slate-950/60 p-3 text-xs text-slate-400"},"TradingView webhook endpoint ready at ",React.createElement("code",null,"/api/feeds/alerts"),". Configure your TradingView alert payload with the shared secret from ",React.createElement("code",null,"TRADINGVIEW_SHARED_SECRET"),". Alerts are forwarded into Kafka and DuckDB for downstream learners."))}function Oe({state:t,onKillSwitch:o,onRestart:p,working:g}){const u=!!(t&&t.kill_switch),f=t&&t.drawdown_threshold?t.drawdown_threshold:null;return React.createElement("div",{className:"rounded-lg border border-slate-800 bg-slate-900/40 p-4 space-y-4"},React.createElement("h3",{className:"text-sm font-semibold uppercase tracking-wide text-slate-200"},"System controls"),React.createElement("div",{className:"flex flex-wrap items-center gap-3"},React.createElement("button",{className:X("rounded px-4 py-2 text-sm font-semibold",u?"bg-red-700 text-white":"bg-emerald-600 text-white"),onClick:()=>o(!u),disabled:g},u?"Disable kill switch":"Enable kill switch"),React.createElement("button",{className:"rounded bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-500 disabled:opacity-60",onClick:p,disabled:g},"Restart orchestrator"),t&&t.last_restart&&React.createElement("span",{className:"text-xs text-slate-400"},"Last restart ",dayjs(t.last_restart).fromNow())),f!==null&&React.createElement("div",{className:"text-xs text-slate-400"},"Kill switch threshold: ",(f*100).toFixed(2),"% drawdown"))}function Ue({status:t,onAction:o,working:p}){const g=t?t.manage_enabled!==!1:!0,u=!!(t&&t.running),f=t&&t.error,L=Array.isArray(t&&t.services)?t.services:[],s=L.length>0,h=t?t.available!==!1:!1,k=u?"bg-emerald-800/60 text-emerald-100 border border-emerald-500/60":"bg-red-900/50 text-red-200 border border-red-500/60",y=L.map((b,j)=>{const D=b.Service||b.Name||b.container||`service-${j}`,i=b.State||b.status||b.Status||"",A=b.Health||b.health||"";return React.createElement("div",{key:D,className:"flex items-center justify-between rounded border border-slate-800/60 px-3 py-1 text-xs"},React.createElement("span",{className:"font-medium text-slate-200"},D),React.createElement("span",{className:"text-slate-400"},i,A?` (${A})`:""))});return React.createElement("div",{className:"rounded-lg border border-slate-800 bg-slate-900/40 p-4 space-y-4"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("h3",{className:"text-sm font-semibold uppercase tracking-wide text-slate-200"},"Kafka & Feeds"),React.createElement("span",{className:X("rounded-full px-2 py-0.5 text-xs font-semibold",k)},u?"Running":"Stopped")),!g&&React.createElement("div",{className:"rounded border border-slate-700 bg-slate-950/80 px-3 py-2 text-xs text-slate-300"},"RunBot is configured with ",React.createElement("code",null,"RUNBOT_SKIP_KAFKA=1"),", so automatic management is disabled."),f&&React.createElement("div",{className:"rounded border border-red-800 bg-red-900/40 px-3 py-2 text-xs text-red-100"},f),!h&&!f&&React.createElement("div",{className:"rounded border border-slate-700 bg-slate-950/80 px-3 py-2 text-xs text-slate-300"},"Compose file not detected yet. Start RunBot or configure the stack to enable management."),React.createElement("div",{className:"flex flex-wrap gap-2"},React.createElement("button",{className:"rounded bg-emerald-600 px-3 py-1.5 text-xs font-semibold text-white hover:bg-emerald-500 disabled:opacity-50",onClick:()=>o("start"),disabled:p||u||!g},"Start"),React.createElement("button",{className:"rounded bg-red-700 px-3 py-1.5 text-xs font-semibold text-white hover:bg-red-600 disabled:opacity-50",onClick:()=>o("stop"),disabled:p||!u||!g},"Stop"),React.createElement("button",{className:"rounded bg-slate-800 px-3 py-1.5 text-xs font-semibold text-slate-200 hover:bg-slate-700 disabled:opacity-50",onClick:()=>o("restart"),disabled:p||!g},"Restart")),React.createElement("div",{className:"space-y-2 text-xs text-slate-300"},s?y:React.createElement("p",{className:"text-slate-500"},"No container status reported yet.")))}function Me(){const t=oe("/api/strategies",xe,{strategies:[],portfolio:null,alerts:[]}),o=oe("/api/system/state",xe,{state:{},alerts:[]}),p=oe("/api/system/kafka",xe,{}),g=oe("/api/trading/status",xe,{paper:{},live:{},guardrails:{},open_positions:{count:0,notional_usd:0,pnl_usd:0,symbols:{}}}),u=oe("/api/backtests",be,{jobs:[],results:[],guardrail_logs:[],guardrail_snapshots:[]}),f=oe("/api/configs",be,{configs:[]}),L=oe("/api/trades?limit=400",be,{records:[],stats:{}}),s=oe("/api/trades/metrics",be,{metrics:{total_events:0,by_stage:{},by_strategy:{}},events:[]}),h=de(()=>Array.isArray(t.data&&t.data.strategies)?t.data.strategies:[],[t.data]),k=de(()=>{const l=t.data&&t.data.manifest;return l&&typeof l=="object"?l:{}},[t.data]),y=de(()=>{const l={};return Object.entries(k).forEach(([n,m])=>{if(!m||typeof m!="object")return;const v=Array.isArray(m.timeframes)?m.timeframes.map(String):[];l[n]={label:m.label||n,description:m.description||"",recommended_timeframes:v,default_timeframe:m.default||v[0]||""}}),h.forEach(n=>{if(!n||!n.strategy)return;const m=n.strategy,v=l[m]||{label:n.strategy_label||m,description:n.strategy_description||"",recommended_timeframes:[],default_timeframe:""},z=Array.isArray(n.recommended_timeframes)?n.recommended_timeframes.map(String):[],U=Array.isArray(v.recommended_timeframes)?v.recommended_timeframes.slice():[];if(z.forEach(Y=>{U.includes(Y)||U.push(Y)}),v.recommended_timeframes=U,!v.default_timeframe){const Y=n.default_timeframe||U[0];Y&&(v.default_timeframe=Y)}!v.label&&n.strategy_label&&(v.label=n.strategy_label),l[m]=v}),l},[k,h]),b=de(()=>{const l=new Set(Object.keys(y));return l.size||h.forEach(n=>{n&&n.strategy&&l.add(n.strategy)}),!l.size&&f.data&&Array.isArray(f.data.configs)&&f.data.configs.forEach(n=>{if(n&&n.name){const m=n.name.replace(/\.[^.]+$/,"");l.add(m)}}),l.size||ke.forEach(n=>l.add(n)),Array.from(l).sort((n,m)=>{const v=y[n]&&y[n].label||n,z=y[m]&&y[m].label||m;return v.localeCompare(z)})},[y,h,f.data]),j=de(()=>{const l=new Set;return h.forEach(n=>{n&&n.symbol&&l.add(String(n.symbol).toUpperCase())}),l.size||Se.forEach(n=>l.add(n)),Array.from(l).sort()},[h]),D=de(()=>{const l=new Set(ge);h.forEach(m=>{m&&m.timeframe&&l.add(String(m.timeframe)),m&&Array.isArray(m.recommended_timeframes)&&m.recommended_timeframes.forEach(v=>l.add(String(v)))}),Object.values(y).forEach(m=>{m&&Array.isArray(m.recommended_timeframes)&&m.recommended_timeframes.forEach(v=>l.add(String(v)))});const n=m=>{const v=ge.indexOf(m);return v===-1?ge.length+m.charCodeAt(0):v};return Array.from(l).sort((m,v)=>{const z=n(m),U=n(v);return z===U?m.localeCompare(v):z-U})},[h,y]),i=de(()=>ye,[]),[A,O]=M(o.data&&o.data.state||{});te(()=>{o.data&&o.data.state&&O(o.data.state)},[o.data]);const[I,J]=M([]),[a,c]=M({showUnderperforming:!1,minTrades:0,sortKey:"sharpe",sortDirection:"desc"}),[P,$]=M(!1),[W,V]=M(!1),[G,Q]=M(!1),[H,ne]=M({paper:!1,live:!1,stop:null}),[Z,ae]=M(!1),[ce,ie]=M(!1),[re,fe]=M(!1),S=ue((l,n="info")=>{J(m=>[...m,{id:`${Date.now()}-${Math.random().toString(16).slice(2)}`,level:n,text:l}])},[]),le=l=>{J(n=>n.filter(m=>m.id!==l))},me=async()=>{if(!Z)try{ae(!0),await q("/api/trades/clear",{method:"POST"}),S("Trade log cleared.","success"),L.refresh(),s.refresh()}catch(l){S(`Clear failed: ${l.message}`,"critical")}finally{ae(!1)}},d=async()=>{if(!ce)try{ie(!0),await q("/api/backtests/jobs/clear",{method:"POST"}),S("Job queue cleared.","success"),u.refresh()}catch(l){S(`Clear job queue failed: ${l.message}`,"critical")}finally{ie(!1)}},_=async()=>{if(!re)try{fe(!0),await q("/api/guardrails/clear",{method:"POST"}),S("Guardrail logs cleared.","success"),u.refresh()}catch(l){S(`Clear guardrail logs failed: ${l.message}`,"critical")}finally{fe(!1)}},F=async l=>{if(!l||!l.config){S("No config available for promotion.","warning");return}try{const n=await q("/api/strategies/promote",{body:{config:l.config}});S("Strategy promoted successfully.","success"),t.refresh(),o.refresh(),u.refresh(),n&&n.summary&&n.summary.destination&&S(`Active config updated: ${n.summary.destination}`,"info")}catch(n){S(`Promotion failed: ${n.message}`,"critical")}},e=l=>{if(!l||!l.config){S("No config available to snapshot.","warning");return}S(`Snapshot stored for ${l.config}`,"info")},r=async(l,n)=>{const m=l==="paper"?"/api/trading/paper":"/api/trading/live";try{ne(Y=>({...Y,[l]:!0}));const v=await q(m,{body:n}),z=v&&v.message?v.message:`${l==="paper"?"Paper":"Live"} trading request submitted.`,U=v&&v.status==="ok"?"success":"info";if(S(z,U),v&&Array.isArray(v.launch_plan)&&v.launch_plan.length){const Y=v.launch_plan.map(pe=>{const ve=pe.strategy||"?",we=pe.timeframe||"?",_e=pe.symbol||"(default)";return`${ve} @ ${we} (${_e})`}).join(", ");S(`Plan: ${Y}`,"info")}v&&Array.isArray(v.details)&&v.details.length&&v.details.forEach(Y=>S(Y,"warning")),g.refresh()}catch(v){S(`${l==="paper"?"Paper":"Live"} trading failed: ${v.message}`,"critical")}finally{ne(v=>({...v,[l]:!1}))}},x=async l=>{try{ne(Y=>({...Y,stop:l||"all"}));const m=await q("/api/trading/stop",{body:l?{mode:l}:{}}),v=m&&m.status?m.status:"stopped",z=v==="stopped"?"success":"info",U=v==="stopped"?"Trading processes stopped.":`Stop response: ${v}`;S(U,z),g.refresh()}catch(n){S(`Stop request failed: ${n.message}`,"critical")}finally{ne(n=>({...n,stop:null}))}},N=async l=>{try{V(!0);const n=await q("/api/backtests",{body:l}),m=n.job_ids||[];m.length?S(`Queued backtests: ${m.join(", ")}`,"success"):S("Backtest request acknowledged.","info");const v=Array.isArray(n.launch_plan)?n.launch_plan:[];if(v.length){const z=v.map(U=>{const Y=U.strategy||"?",pe=U.timeframe||"?",ve=Array.isArray(U.symbols)&&U.symbols.length?U.symbols.join("/"):"default";return`${Y} @ ${pe} (${ve})`}).join(", ");S(`Launch plan: ${z}`,"info")}Array.isArray(n.warnings)&&n.warnings.length&&n.warnings.forEach(z=>S(z,"warning")),u.refresh(),t.refresh()}catch(n){S(`Backtest launch failed: ${n.message}`,"critical")}finally{V(!1)}},w=async(l,n)=>{try{await q(`/api/configs/${encodeURIComponent(l.name)}`,{method:"PUT",body:{content:n}}),S(`Saved ${l.name}`,"success"),f.refresh()}catch(m){throw S(`Save failed: ${m.message}`,"critical"),m}},E=async l=>{try{await q(`/api/configs/${encodeURIComponent(l.name)}/revert`,{method:"POST"}),S(`Reverted ${l.name}`,"info"),f.refresh()}catch(n){throw S(`Revert failed: ${n.message}`,"critical"),n}},C=async l=>{try{const n=await q("/learning/toggle",{body:l});n&&n.state?O(n.state):O(m=>({...m,...l})),S("Learning settings updated.","success"),o.refresh()}catch(n){S(`Update failed: ${n.message}`,"critical")}},T=async l=>{try{$(!0),await q("/api/system/kill-switch",{body:{armed:l}}),S(`Kill switch ${l?"armed":"disarmed"}.`,"success"),o.refresh(),t.refresh()}catch(n){S(`Kill switch failed: ${n.message}`,"critical")}finally{$(!1)}},K=async()=>{try{$(!0);const l=await q("/api/system/restart",{body:{}});S(`Restarted orchestrator. Cancelled jobs: ${l.cancelled_jobs||0}`,"success"),o.refresh(),u.refresh(),t.refresh()}catch(l){S(`Restart failed: ${l.message}`,"critical")}finally{$(!1)}},se=async l=>{const n=l?l.charAt(0).toUpperCase()+l.slice(1):"Status";if(!G)try{Q(!0);const m=await q("/api/system/kafka",{body:{action:l}}),v=m&&m.success!==!1,z=m?.error||m?.start?.error||m?.stop?.error||m?.stderr||"",U=v?`Kafka ${n.toLowerCase()} request completed.`:`Kafka ${n.toLowerCase()} request encountered issues${z?`: ${z}`:""}.`;S(U,v?"success":"critical"),p.refresh(),o.refresh()}catch(m){S(`Kafka ${n.toLowerCase()} failed: ${m.message}`,"critical")}finally{Q(!1)}},ee=[...t.data&&t.data.alerts?t.data.alerts:[],...o.data&&o.data.alerts?o.data.alerts:[]],B=g.data||{};if(B.guardrails&&B.guardrails.paper_is_recent===!1&&ee.push({level:"warning",message:"Paper trading session is stale. Run paper before going live."}),g.error){const l=g.error.message||String(g.error);ee.push({level:"critical",message:`Trading status error: ${l}`})}if(p.error){const l=p.error.message||String(p.error);ee.push({level:"critical",message:`Kafka status error: ${l}`})}const R=p.data||{};return React.createElement("div",{className:"flex min-h-screen flex-col bg-slate-950 text-slate-100"},React.createElement(Ae,{alerts:ee,messages:I,onDismiss:le}),React.createElement("main",{className:"mx-auto w-full max-w-7xl flex-1 space-y-10 px-4 py-8"},React.createElement("header",{className:"space-y-3"},React.createElement("h1",{className:"text-2xl font-semibold text-white"},"AI Trading Bot Control Center"),React.createElement("p",{className:"text-sm text-slate-400"},"Monitor live strategies, launch research jobs, and steer the adaptive learning loop across BitMEX symbols."),React.createElement($e,{portfolio:t.data&&t.data.portfolio})),React.createElement("section",{className:"space-y-4"},React.createElement("h2",{className:"text-lg font-semibold text-white"},"Strategy monitoring"),React.createElement(Te,{strategies:t.data&&t.data.strategies,filters:a,onFilterChange:c,onPromote:F,onSnapshot:e})),React.createElement("section",{className:"space-y-4"},React.createElement("h2",{className:"text-lg font-semibold text-white"},"Backtest management"),React.createElement(De,{data:u.data||{},onLaunch:N,launching:W,strategyOptions:b,strategyMetadata:y,symbolOptions:j,timeframeOptions:D,capitalOptions:i,onNotify:S,onRefresh:u.refresh,onClearJobs:d,clearingJobs:ce,onClearGuardrails:_,clearingGuardrails:re})),React.createElement("section",{className:"space-y-4"},React.createElement("h2",{className:"text-lg font-semibold text-white"},"Execution control"),React.createElement(je,{status:g.data||{},strategyOptions:b,strategyMetadata:y,symbolOptions:j,timeframeOptions:D,capitalOptions:i,onStartPaper:l=>r("paper",l),onStartLive:l=>r("live",l),onStop:x,onNotify:S,working:H})),React.createElement("section",{className:"grid gap-6 md:grid-cols-[2fr,1fr]"},React.createElement("div",{className:"space-y-4"},React.createElement("h2",{className:"text-lg font-semibold text-white"},"Trade log & rolling stats"),React.createElement(Re,{data:L.data||{},strategyMetadata:y,onClear:me,clearing:Z}),React.createElement(Pe,{data:s.data||{}})),React.createElement("div",{className:"space-y-4"},React.createElement(Ue,{status:R,onAction:se,working:G}),React.createElement(Oe,{state:o.data&&o.data.state,onKillSwitch:T,onRestart:K,working:P}),React.createElement(Fe,{state:A,onToggle:C}))),React.createElement("section",{className:"space-y-4"},React.createElement("h2",{className:"text-lg font-semibold text-white"},"Configuration management"),React.createElement(Ee,{data:f.data||{configs:[]},onSave:w,onRevert:E,loading:f.loading}))))}const Ne=document.getElementById("app-root");Ne&&ReactDOM.createRoot(Ne).render(React.createElement(Me,null));})();
